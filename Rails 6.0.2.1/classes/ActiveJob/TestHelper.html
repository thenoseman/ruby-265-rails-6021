<!DOCTYPE html>
<html lang="en">
<head>
    <title>ActiveJob::TestHelper</title>
    <meta charset="UTF-8" />
    <link rel="stylesheet" href="../../css/reset.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../../css/main.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../../css/github.css" type="text/css" media="screen" />
<script src="../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
<script src="../../js/main.js" type="text/javascript" charset="utf-8"></script>
<script src="../../js/highlight.pack.js" type="text/javascript" charset="utf-8"></script>


    <meta property="og:title" value="ActiveJob::TestHelper">

  
    
    <meta name="description" content="Provides helper methods for testing Active Job.">
    <meta property="og:description" content="Provides helper methods for testing Active Job.">
  

    <meta name="keywords" content="ActiveJob::TestHelper class">
  
    <meta name="keywords" content="queue_adapter_for_test, assert_enqueued_jobs, assert_no_enqueued_jobs, assert_performed_jobs, assert_no_performed_jobs, assert_enqueued_with, assert_performed_with, perform_enqueued_jobs, queue_adapter">
  
</head>

<body>
    <div class="banner">
        
        <h1>
            <span class="type">Module</span>
            ActiveJob::TestHelper
            
        </h1>
        <ul class="files">
            
            <li><a href="../../files/activejob/lib/active_job/test_helper_rb.html">activejob/lib/active_job/test_helper.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
  
    <div class="description">
      
<p>Provides helper methods for testing Active Job</p>

    </div>
  


  


  
  


  
    <!-- Namespace -->
    <div class="sectiontitle">Namespace</div>
    <ul>
      
        <li>
          <span class="type">MODULE</span>
          <a href="TestHelper/TestQueueAdapter.html">ActiveJob::TestHelper::TestQueueAdapter</a>
        </li>
      
    </ul>
  


  
    <!-- Method ref -->
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
      
        <dt>A</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-assert_enqueued_jobs">assert_enqueued_jobs</a>,
              </li>
            
              
              <li>
                <a href="#method-i-assert_enqueued_with">assert_enqueued_with</a>,
              </li>
            
              
              <li>
                <a href="#method-i-assert_no_enqueued_jobs">assert_no_enqueued_jobs</a>,
              </li>
            
              
              <li>
                <a href="#method-i-assert_no_performed_jobs">assert_no_performed_jobs</a>,
              </li>
            
              
              <li>
                <a href="#method-i-assert_performed_jobs">assert_performed_jobs</a>,
              </li>
            
              
              <li>
                <a href="#method-i-assert_performed_with">assert_performed_with</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>P</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-perform_enqueued_jobs">perform_enqueued_jobs</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>Q</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-queue_adapter">queue_adapter</a>,
              </li>
            
              
              <li>
                <a href="#method-i-queue_adapter_for_test">queue_adapter_for_test</a>
              </li>
            
          </ul>
        </dd>
      
    </dl>
  

  



  

    

    

    


    


    <!-- Methods -->
    
    
      <div class="sectiontitle">Instance Public methods</div>
      
        <div class="method">
          <div class="title method-title" id="method-i-assert_enqueued_jobs">
            
              <b>assert_enqueued_jobs</b>(number, only: nil, except: nil, queue: nil)
            
            <a href="../../classes/ActiveJob/TestHelper.html#method-i-assert_enqueued_jobs" name="method-i-assert_enqueued_jobs" class="permalink">Link</a>
          </div>

          
            <div class="description">
              <p>Asserts that the number of enqueued jobs matches the given number.</p>

<pre><code>def test_jobs
  assert_enqueued_jobs 0
  HelloJob.perform_later(&#39;david&#39;)
  assert_enqueued_jobs 1
  HelloJob.perform_later(&#39;abdelkader&#39;)
  assert_enqueued_jobs 2
end
</code></pre>

<p>If a block is passed, asserts that the block will cause the specified number of jobs to be enqueued.</p>

<pre><code>def test_jobs_again
  assert_enqueued_jobs 1 do
    HelloJob.perform_later(&#39;cristian&#39;)
  end

  assert_enqueued_jobs 2 do
    HelloJob.perform_later(&#39;aaron&#39;)
    HelloJob.perform_later(&#39;rafael&#39;)
  end
end
</code></pre>

<p>Asserts the number of times a specific job was enqueued by passing <code>:only</code> option.</p>

<pre><code>def test_logging_job
  assert_enqueued_jobs 1, only: LoggingJob do
    LoggingJob.perform_later
    HelloJob.perform_later(&#39;jeremy&#39;)
  end
end
</code></pre>

<p>Asserts the number of times a job except specific class was enqueued by passing <code>:except</code> option.</p>

<pre><code>def test_logging_job
  assert_enqueued_jobs 1, except: HelloJob do
    LoggingJob.perform_later
    HelloJob.perform_later(&#39;jeremy&#39;)
  end
end
</code></pre>

<p><code>:only</code> and <code>:except</code> options accepts <a href="../Class.html"><code>Class</code></a>, <a href="../Array.html"><code>Array</code></a> of <a href="../Class.html"><code>Class</code></a> or Proc. When passed a Proc, a hash containing the job&#39;s class and it&#39;s argument are passed as argument.</p>

<p>Asserts the number of times a job is enqueued to a specific queue by passing <code>:queue</code> option.</p>

<pre><code>def test_logging_job
  assert_enqueued_jobs 2, queue: &#39;default&#39; do
    LoggingJob.perform_later
    HelloJob.perform_later(&#39;elfassy&#39;)
  end
end
</code></pre>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-assert_enqueued_jobs_source')" id="l_method-i-assert_enqueued_jobs_source">show</a>
                
              </p>
              <div id="method-i-assert_enqueued_jobs_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File activejob/lib/active_job/test_helper.rb</span>
<span class="line-num">120</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">assert_enqueued_jobs</span>(<span class="ruby-identifier">number</span>, <span class="ruby-value">only:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-value">except:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-value">queue:</span> <span class="ruby-keyword">nil</span>)
<span class="line-num">121</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">block_given?</span>
<span class="line-num">122</span>     <span class="ruby-identifier">original_count</span> = <span class="ruby-identifier">enqueued_jobs_with</span>(<span class="ruby-value">only:</span> <span class="ruby-identifier">only</span>, <span class="ruby-value">except:</span> <span class="ruby-identifier">except</span>, <span class="ruby-value">queue:</span> <span class="ruby-identifier">queue</span>)
<span class="line-num">123</span> 
<span class="line-num">124</span>     <span class="ruby-keyword">yield</span>
<span class="line-num">125</span> 
<span class="line-num">126</span>     <span class="ruby-identifier">new_count</span> = <span class="ruby-identifier">enqueued_jobs_with</span>(<span class="ruby-value">only:</span> <span class="ruby-identifier">only</span>, <span class="ruby-value">except:</span> <span class="ruby-identifier">except</span>, <span class="ruby-value">queue:</span> <span class="ruby-identifier">queue</span>)
<span class="line-num">127</span> 
<span class="line-num">128</span>     <span class="ruby-identifier">actual_count</span> = <span class="ruby-identifier">new_count</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">original_count</span>
<span class="line-num">129</span>   <span class="ruby-keyword">else</span>
<span class="line-num">130</span>     <span class="ruby-identifier">actual_count</span> = <span class="ruby-identifier">enqueued_jobs_with</span>(<span class="ruby-value">only:</span> <span class="ruby-identifier">only</span>, <span class="ruby-value">except:</span> <span class="ruby-identifier">except</span>, <span class="ruby-value">queue:</span> <span class="ruby-identifier">queue</span>)
<span class="line-num">131</span>   <span class="ruby-keyword">end</span>
<span class="line-num">132</span> 
<span class="line-num">133</span>   <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">number</span>, <span class="ruby-identifier">actual_count</span>, <span class="ruby-node">&quot;#{number} jobs expected, but #{actual_count} were enqueued&quot;</span>
<span class="line-num">134</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-assert_enqueued_with">
            
              <b>assert_enqueued_with</b>(job: nil, args: nil, at: nil, queue: nil)
            
            <a href="../../classes/ActiveJob/TestHelper.html#method-i-assert_enqueued_with" name="method-i-assert_enqueued_with" class="permalink">Link</a>
          </div>

          
            <div class="description">
              <p>Asserts that the job has been enqueued with the given arguments.</p>

<pre><code>def test_assert_enqueued_with
  MyJob.perform_later(1,2,3)
  assert_enqueued_with(job: MyJob, args: [1,2,3], queue: &#39;low&#39;)

  MyJob.set(wait_until: Date.tomorrow.noon).perform_later
  assert_enqueued_with(job: MyJob, at: Date.tomorrow.noon)
end
</code></pre>

<p>The <code>args</code> argument also accepts a proc which will get passed the actual job&#39;s arguments. Your proc needs to return a boolean value determining if the job&#39;s arguments matches your expectation. This is useful to check only for a subset of arguments.</p>

<pre><code>def test_assert_enqueued_with
  expected_args = -&gt;(job_args) do
    assert job_args.first.key?(:foo)
  end

  MyJob.perform_later(foo: &#39;bar&#39;, other_arg: &#39;No need to check in the test&#39;)
  assert_enqueued_with(job: MyJob, args: expected_args, queue: &#39;low&#39;)
end
</code></pre>

<p>If a block is passed, asserts that the block will cause the job to be enqueued with the given arguments.</p>

<pre><code>def test_assert_enqueued_with
  assert_enqueued_with(job: MyJob, args: [1,2,3], queue: &#39;low&#39;) do
    MyJob.perform_later(1,2,3)
  end

  assert_enqueued_with(job: MyJob, at: Date.tomorrow.noon) do
    MyJob.set(wait_until: Date.tomorrow.noon).perform_later
  end
end
</code></pre>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-assert_enqueued_with_source')" id="l_method-i-assert_enqueued_with_source">show</a>
                
              </p>
              <div id="method-i-assert_enqueued_with_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File activejob/lib/active_job/test_helper.rb</span>
<span class="line-num">382</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">assert_enqueued_with</span>(<span class="ruby-value">job:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-value">args:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-value">at:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-value">queue:</span> <span class="ruby-keyword">nil</span>)
<span class="line-num">383</span>   <span class="ruby-identifier">expected</span> = { <span class="ruby-value">job:</span> <span class="ruby-identifier">job</span>, <span class="ruby-value">args:</span> <span class="ruby-identifier">args</span>, <span class="ruby-value">at:</span> <span class="ruby-identifier">at</span>, <span class="ruby-value">queue:</span> <span class="ruby-identifier">queue</span> }.<span class="ruby-identifier">compact</span>
<span class="line-num">384</span>   <span class="ruby-identifier">expected_args</span> = <span class="ruby-identifier">prepare_args_for_assertion</span>(<span class="ruby-identifier">expected</span>)
<span class="line-num">385</span> 
<span class="line-num">386</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">block_given?</span>
<span class="line-num">387</span>     <span class="ruby-identifier">original_enqueued_jobs_count</span> = <span class="ruby-identifier">enqueued_jobs</span>.<span class="ruby-identifier">count</span>
<span class="line-num">388</span> 
<span class="line-num">389</span>     <span class="ruby-keyword">yield</span>
<span class="line-num">390</span> 
<span class="line-num">391</span>     <span class="ruby-identifier">jobs</span> = <span class="ruby-identifier">enqueued_jobs</span>.<span class="ruby-identifier">drop</span>(<span class="ruby-identifier">original_enqueued_jobs_count</span>)
<span class="line-num">392</span>   <span class="ruby-keyword">else</span>
<span class="line-num">393</span>     <span class="ruby-identifier">jobs</span> = <span class="ruby-identifier">enqueued_jobs</span>
<span class="line-num">394</span>   <span class="ruby-keyword">end</span>
<span class="line-num">395</span> 
<span class="line-num">396</span>   <span class="ruby-identifier">matching_job</span> = <span class="ruby-identifier">jobs</span>.<span class="ruby-identifier">find</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">enqueued_job</span><span class="ruby-operator">|</span>
<span class="line-num">397</span>     <span class="ruby-identifier">deserialized_job</span> = <span class="ruby-identifier">deserialize_args_for_assertion</span>(<span class="ruby-identifier">enqueued_job</span>)
<span class="line-num">398</span> 
<span class="line-num">399</span>     <span class="ruby-identifier">expected_args</span>.<span class="ruby-identifier">all?</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span>, <span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
<span class="line-num">400</span>       <span class="ruby-keyword">if</span> <span class="ruby-identifier">value</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:call</span>)
<span class="line-num">401</span>         <span class="ruby-identifier">value</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">deserialized_job</span>[<span class="ruby-identifier">key</span>])
<span class="line-num">402</span>       <span class="ruby-keyword">else</span>
<span class="line-num">403</span>         <span class="ruby-identifier">value</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">deserialized_job</span>[<span class="ruby-identifier">key</span>]
<span class="line-num">404</span>       <span class="ruby-keyword">end</span>
<span class="line-num">405</span>     <span class="ruby-keyword">end</span>
<span class="line-num">406</span>   <span class="ruby-keyword">end</span>
<span class="line-num">407</span> 
<span class="line-num">408</span>   <span class="ruby-identifier">assert</span> <span class="ruby-identifier">matching_job</span>, <span class="ruby-node">&quot;No enqueued job found with #{expected}&quot;</span>
<span class="line-num">409</span>   <span class="ruby-identifier">instantiate_job</span>(<span class="ruby-identifier">matching_job</span>)
<span class="line-num">410</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-assert_no_enqueued_jobs">
            
              <b>assert_no_enqueued_jobs</b>(only: nil, except: nil, queue: nil, &amp;block)
            
            <a href="../../classes/ActiveJob/TestHelper.html#method-i-assert_no_enqueued_jobs" name="method-i-assert_no_enqueued_jobs" class="permalink">Link</a>
          </div>

          
            <div class="description">
              <p>Asserts that no jobs have been enqueued.</p>

<pre><code>def test_jobs
  assert_no_enqueued_jobs
  HelloJob.perform_later(&#39;jeremy&#39;)
  assert_enqueued_jobs 1
end
</code></pre>

<p>If a block is passed, asserts that the block will not cause any job to be enqueued.</p>

<pre><code>def test_jobs_again
  assert_no_enqueued_jobs do
    # No job should be enqueued from this block
  end
end
</code></pre>

<p>Asserts that no jobs of a specific kind are enqueued by passing <code>:only</code> option.</p>

<pre><code>def test_no_logging
  assert_no_enqueued_jobs only: LoggingJob do
    HelloJob.perform_later(&#39;jeremy&#39;)
  end
end
</code></pre>

<p>Asserts that no jobs except specific class are enqueued by passing <code>:except</code> option.</p>

<pre><code>def test_no_logging
  assert_no_enqueued_jobs except: HelloJob do
    HelloJob.perform_later(&#39;jeremy&#39;)
  end
end
</code></pre>

<p><code>:only</code> and <code>:except</code> options accepts <a href="../Class.html"><code>Class</code></a>, <a href="../Array.html"><code>Array</code></a> of <a href="../Class.html"><code>Class</code></a> or Proc. When passed a Proc, a hash containing the job&#39;s class and it&#39;s argument are passed as argument.</p>

<p>Asserts that no jobs are enqueued to a specific queue by passing <code>:queue</code> option</p>

<pre><code>def test_no_logging
  assert_no_enqueued_jobs queue: &#39;default&#39; do
    LoggingJob.set(queue: :some_queue).perform_later
  end
end
</code></pre>

<p>Note: This assertion is simply a shortcut for:</p>

<pre><code>assert_enqueued_jobs 0, &amp;block
</code></pre>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-assert_no_enqueued_jobs_source')" id="l_method-i-assert_no_enqueued_jobs_source">show</a>
                
              </p>
              <div id="method-i-assert_no_enqueued_jobs_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File activejob/lib/active_job/test_helper.rb</span>
<span class="line-num">182</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">assert_no_enqueued_jobs</span>(<span class="ruby-value">only:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-value">except:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-value">queue:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">183</span>   <span class="ruby-identifier">assert_enqueued_jobs</span> <span class="ruby-value">0</span>, <span class="ruby-value">only:</span> <span class="ruby-identifier">only</span>, <span class="ruby-value">except:</span> <span class="ruby-identifier">except</span>, <span class="ruby-value">queue:</span> <span class="ruby-identifier">queue</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>
<span class="line-num">184</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-assert_no_performed_jobs">
            
              <b>assert_no_performed_jobs</b>(only: nil, except: nil, queue: nil, &amp;block)
            
            <a href="../../classes/ActiveJob/TestHelper.html#method-i-assert_no_performed_jobs" name="method-i-assert_no_performed_jobs" class="permalink">Link</a>
          </div>

          
            <div class="description">
              <p>Asserts that no jobs have been performed.</p>

<pre><code>def test_jobs
  assert_no_performed_jobs

  perform_enqueued_jobs do
    HelloJob.perform_later(&#39;matthew&#39;)
    assert_performed_jobs 1
  end
end
</code></pre>

<p>If a block is passed, asserts that the block will not cause any job to be performed.</p>

<pre><code>def test_jobs_again
  assert_no_performed_jobs do
    # No job should be performed from this block
  end
end
</code></pre>

<p>The block form supports filtering. If the <code>:only</code> option is specified, then only the listed job(s) will not be performed.</p>

<pre><code>def test_no_logging
  assert_no_performed_jobs only: LoggingJob do
    HelloJob.perform_later(&#39;jeremy&#39;)
  end
end
</code></pre>

<p>Also if the <code>:except</code> option is specified, then the job(s) except specific class will not be performed.</p>

<pre><code>def test_no_logging
  assert_no_performed_jobs except: HelloJob do
    HelloJob.perform_later(&#39;jeremy&#39;)
  end
end
</code></pre>

<p><code>:only</code> and <code>:except</code> options accepts <a href="../Class.html"><code>Class</code></a>, <a href="../Array.html"><code>Array</code></a> of <a href="../Class.html"><code>Class</code></a> or Proc. When passed a Proc, an instance of the job will be passed as argument.</p>

<p>If the <code>:queue</code> option is specified, then only the job(s) enqueued to a specific queue will not be performed.</p>

<pre><code>def test_assert_no_performed_jobs_with_queue_option
  assert_no_performed_jobs queue: :some_queue do
    HelloJob.set(queue: :other_queue).perform_later(&quot;jeremy&quot;)
  end
end
</code></pre>

<p>Note: This assertion is simply a shortcut for:</p>

<pre><code>assert_performed_jobs 0, &amp;block
</code></pre>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-assert_no_performed_jobs_source')" id="l_method-i-assert_no_performed_jobs_source">show</a>
                
              </p>
              <div id="method-i-assert_no_performed_jobs_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File activejob/lib/active_job/test_helper.rb</span>
<span class="line-num">340</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">assert_no_performed_jobs</span>(<span class="ruby-value">only:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-value">except:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-value">queue:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">341</span>   <span class="ruby-identifier">assert_performed_jobs</span> <span class="ruby-value">0</span>, <span class="ruby-value">only:</span> <span class="ruby-identifier">only</span>, <span class="ruby-value">except:</span> <span class="ruby-identifier">except</span>, <span class="ruby-value">queue:</span> <span class="ruby-identifier">queue</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>
<span class="line-num">342</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-assert_performed_jobs">
            
              <b>assert_performed_jobs</b>(number, only: nil, except: nil, queue: nil, &amp;block)
            
            <a href="../../classes/ActiveJob/TestHelper.html#method-i-assert_performed_jobs" name="method-i-assert_performed_jobs" class="permalink">Link</a>
          </div>

          
            <div class="description">
              <p>Asserts that the number of performed jobs matches the given number. If no block is passed, <code>perform_enqueued_jobs</code> must be called around or after the job call.</p>

<pre><code>def test_jobs
  assert_performed_jobs 0

  perform_enqueued_jobs do
    HelloJob.perform_later(&#39;xavier&#39;)
  end
  assert_performed_jobs 1

  HelloJob.perform_later(&#39;yves&#39;)

  perform_enqueued_jobs

  assert_performed_jobs 2
end
</code></pre>

<p>If a block is passed, asserts that the block will cause the specified number of jobs to be performed.</p>

<pre><code>def test_jobs_again
  assert_performed_jobs 1 do
    HelloJob.perform_later(&#39;robin&#39;)
  end

  assert_performed_jobs 2 do
    HelloJob.perform_later(&#39;carlos&#39;)
    HelloJob.perform_later(&#39;sean&#39;)
  end
end
</code></pre>

<p>This method also supports filtering. If the <code>:only</code> option is specified, then only the listed job(s) will be performed.</p>

<pre><code>def test_hello_job
  assert_performed_jobs 1, only: HelloJob do
    HelloJob.perform_later(&#39;jeremy&#39;)
    LoggingJob.perform_later
  end
end
</code></pre>

<p>Also if the <code>:except</code> option is specified, then the job(s) except specific class will be performed.</p>

<pre><code>def test_hello_job
  assert_performed_jobs 1, except: LoggingJob do
    HelloJob.perform_later(&#39;jeremy&#39;)
    LoggingJob.perform_later
  end
end
</code></pre>

<p>An array may also be specified, to support testing multiple jobs.</p>

<pre><code>def test_hello_and_logging_jobs
  assert_nothing_raised do
    assert_performed_jobs 2, only: [HelloJob, LoggingJob] do
      HelloJob.perform_later(&#39;jeremy&#39;)
      LoggingJob.perform_later(&#39;stewie&#39;)
      RescueJob.perform_later(&#39;david&#39;)
    end
  end
end
</code></pre>

<p>A proc may also be specified. When passed a Proc, the job&#39;s instance will be passed as argument.</p>

<pre><code>def test_hello_and_logging_jobs
  assert_nothing_raised do
    assert_performed_jobs(1, only: -&gt;(job) { job.is_a?(HelloJob) }) do
      HelloJob.perform_later(&#39;jeremy&#39;)
      LoggingJob.perform_later(&#39;stewie&#39;)
      RescueJob.perform_later(&#39;david&#39;)
    end
  end
end
</code></pre>

<p>If the <code>:queue</code> option is specified, then only the job(s) enqueued to a specific queue will be performed.</p>

<pre><code>def test_assert_performed_jobs_with_queue_option
  assert_performed_jobs 1, queue: :some_queue do
    HelloJob.set(queue: :some_queue).perform_later(&quot;jeremy&quot;)
    HelloJob.set(queue: :other_queue).perform_later(&quot;bogdan&quot;)
  end
end
</code></pre>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-assert_performed_jobs_source')" id="l_method-i-assert_performed_jobs_source">show</a>
                
              </p>
              <div id="method-i-assert_performed_jobs_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File activejob/lib/active_job/test_helper.rb</span>
<span class="line-num">272</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">assert_performed_jobs</span>(<span class="ruby-identifier">number</span>, <span class="ruby-value">only:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-value">except:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-value">queue:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">273</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">block_given?</span>
<span class="line-num">274</span>     <span class="ruby-identifier">original_count</span> = <span class="ruby-identifier">performed_jobs</span>.<span class="ruby-identifier">size</span>
<span class="line-num">275</span> 
<span class="line-num">276</span>     <span class="ruby-identifier">perform_enqueued_jobs</span>(<span class="ruby-value">only:</span> <span class="ruby-identifier">only</span>, <span class="ruby-value">except:</span> <span class="ruby-identifier">except</span>, <span class="ruby-value">queue:</span> <span class="ruby-identifier">queue</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">277</span> 
<span class="line-num">278</span>     <span class="ruby-identifier">new_count</span> = <span class="ruby-identifier">performed_jobs</span>.<span class="ruby-identifier">size</span>
<span class="line-num">279</span> 
<span class="line-num">280</span>     <span class="ruby-identifier">performed_jobs_size</span> = <span class="ruby-identifier">new_count</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">original_count</span>
<span class="line-num">281</span>   <span class="ruby-keyword">else</span>
<span class="line-num">282</span>     <span class="ruby-identifier">performed_jobs_size</span> = <span class="ruby-identifier">performed_jobs_with</span>(<span class="ruby-value">only:</span> <span class="ruby-identifier">only</span>, <span class="ruby-value">except:</span> <span class="ruby-identifier">except</span>, <span class="ruby-value">queue:</span> <span class="ruby-identifier">queue</span>)
<span class="line-num">283</span>   <span class="ruby-keyword">end</span>
<span class="line-num">284</span> 
<span class="line-num">285</span>   <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">number</span>, <span class="ruby-identifier">performed_jobs_size</span>, <span class="ruby-node">&quot;#{number} jobs expected, but #{performed_jobs_size} were performed&quot;</span>
<span class="line-num">286</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-assert_performed_with">
            
              <b>assert_performed_with</b>(job: nil, args: nil, at: nil, queue: nil, &amp;block)
            
            <a href="../../classes/ActiveJob/TestHelper.html#method-i-assert_performed_with" name="method-i-assert_performed_with" class="permalink">Link</a>
          </div>

          
            <div class="description">
              <p>Asserts that the job has been performed with the given arguments.</p>

<pre><code>def test_assert_performed_with
  MyJob.perform_later(1,2,3)

  perform_enqueued_jobs

  assert_performed_with(job: MyJob, args: [1,2,3], queue: &#39;high&#39;)

  MyJob.set(wait_until: Date.tomorrow.noon).perform_later

  perform_enqueued_jobs

  assert_performed_with(job: MyJob, at: Date.tomorrow.noon)
end
</code></pre>

<p>The <code>args</code> argument also accepts a proc which will get passed the actual job&#39;s arguments. Your proc needs to return a boolean value determining if the job&#39;s arguments matches your expectation. This is useful to check only for a subset of arguments.</p>

<pre><code>def test_assert_performed_with
  expected_args = -&gt;(job_args) do
    assert job_args.first.key?(:foo)
  end
  MyJob.perform_later(foo: &#39;bar&#39;, other_arg: &#39;No need to check in the test&#39;)

  perform_enqueued_jobs

  assert_performed_with(job: MyJob, args: expected_args, queue: &#39;high&#39;)
end
</code></pre>

<p>If a block is passed, that block performs all of the jobs that were enqueued throughout the duration of the block and asserts that the job has been performed with the given arguments in the block.</p>

<pre><code>def test_assert_performed_with
  assert_performed_with(job: MyJob, args: [1,2,3], queue: &#39;high&#39;) do
    MyJob.perform_later(1,2,3)
  end

  assert_performed_with(job: MyJob, at: Date.tomorrow.noon) do
    MyJob.set(wait_until: Date.tomorrow.noon).perform_later
  end
end
</code></pre>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-assert_performed_with_source')" id="l_method-i-assert_performed_with_source">show</a>
                
              </p>
              <div id="method-i-assert_performed_with_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File activejob/lib/active_job/test_helper.rb</span>
<span class="line-num">457</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">assert_performed_with</span>(<span class="ruby-value">job:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-value">args:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-value">at:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-value">queue:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">458</span>   <span class="ruby-identifier">expected</span> = { <span class="ruby-value">job:</span> <span class="ruby-identifier">job</span>, <span class="ruby-value">args:</span> <span class="ruby-identifier">args</span>, <span class="ruby-value">at:</span> <span class="ruby-identifier">at</span>, <span class="ruby-value">queue:</span> <span class="ruby-identifier">queue</span> }.<span class="ruby-identifier">compact</span>
<span class="line-num">459</span>   <span class="ruby-identifier">expected_args</span> = <span class="ruby-identifier">prepare_args_for_assertion</span>(<span class="ruby-identifier">expected</span>)
<span class="line-num">460</span> 
<span class="line-num">461</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">block_given?</span>
<span class="line-num">462</span>     <span class="ruby-identifier">original_performed_jobs_count</span> = <span class="ruby-identifier">performed_jobs</span>.<span class="ruby-identifier">count</span>
<span class="line-num">463</span> 
<span class="line-num">464</span>     <span class="ruby-identifier">perform_enqueued_jobs</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">465</span> 
<span class="line-num">466</span>     <span class="ruby-identifier">jobs</span> = <span class="ruby-identifier">performed_jobs</span>.<span class="ruby-identifier">drop</span>(<span class="ruby-identifier">original_performed_jobs_count</span>)
<span class="line-num">467</span>   <span class="ruby-keyword">else</span>
<span class="line-num">468</span>     <span class="ruby-identifier">jobs</span> = <span class="ruby-identifier">performed_jobs</span>
<span class="line-num">469</span>   <span class="ruby-keyword">end</span>
<span class="line-num">470</span> 
<span class="line-num">471</span>   <span class="ruby-identifier">matching_job</span> = <span class="ruby-identifier">jobs</span>.<span class="ruby-identifier">find</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">enqueued_job</span><span class="ruby-operator">|</span>
<span class="line-num">472</span>     <span class="ruby-identifier">deserialized_job</span> = <span class="ruby-identifier">deserialize_args_for_assertion</span>(<span class="ruby-identifier">enqueued_job</span>)
<span class="line-num">473</span> 
<span class="line-num">474</span>     <span class="ruby-identifier">expected_args</span>.<span class="ruby-identifier">all?</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span>, <span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
<span class="line-num">475</span>       <span class="ruby-keyword">if</span> <span class="ruby-identifier">value</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:call</span>)
<span class="line-num">476</span>         <span class="ruby-identifier">value</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">deserialized_job</span>[<span class="ruby-identifier">key</span>])
<span class="line-num">477</span>       <span class="ruby-keyword">else</span>
<span class="line-num">478</span>         <span class="ruby-identifier">value</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">deserialized_job</span>[<span class="ruby-identifier">key</span>]
<span class="line-num">479</span>       <span class="ruby-keyword">end</span>
<span class="line-num">480</span>     <span class="ruby-keyword">end</span>
<span class="line-num">481</span>   <span class="ruby-keyword">end</span>
<span class="line-num">482</span> 
<span class="line-num">483</span>   <span class="ruby-identifier">assert</span> <span class="ruby-identifier">matching_job</span>, <span class="ruby-node">&quot;No performed job found with #{expected}&quot;</span>
<span class="line-num">484</span>   <span class="ruby-identifier">instantiate_job</span>(<span class="ruby-identifier">matching_job</span>)
<span class="line-num">485</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-perform_enqueued_jobs">
            
              <b>perform_enqueued_jobs</b>(only: nil, except: nil, queue: nil)
            
            <a href="../../classes/ActiveJob/TestHelper.html#method-i-perform_enqueued_jobs" name="method-i-perform_enqueued_jobs" class="permalink">Link</a>
          </div>

          
            <div class="description">
              <p>Performs all enqueued jobs. If a block is given, performs all of the jobs that were enqueued throughout the duration of the block. If a block is not given, performs all of the enqueued jobs up to this point in the test.</p>

<pre><code>def test_perform_enqueued_jobs
  perform_enqueued_jobs do
    MyJob.perform_later(1, 2, 3)
  end
  assert_performed_jobs 1
end

def test_perform_enqueued_jobs_without_block
  MyJob.perform_later(1, 2, 3)

  perform_enqueued_jobs

  assert_performed_jobs 1
end
</code></pre>

<p>This method also supports filtering. If the <code>:only</code> option is specified, then only the listed job(s) will be performed.</p>

<pre><code>def test_perform_enqueued_jobs_with_only
  perform_enqueued_jobs(only: MyJob) do
    MyJob.perform_later(1, 2, 3) # will be performed
    HelloJob.perform_later(1, 2, 3) # will not be performed
  end
  assert_performed_jobs 1
end
</code></pre>

<p>Also if the <code>:except</code> option is specified, then the job(s) except specific class will be performed.</p>

<pre><code>def test_perform_enqueued_jobs_with_except
  perform_enqueued_jobs(except: HelloJob) do
    MyJob.perform_later(1, 2, 3) # will be performed
    HelloJob.perform_later(1, 2, 3) # will not be performed
  end
  assert_performed_jobs 1
end
</code></pre>

<p><code>:only</code> and <code>:except</code> options accepts <a href="../Class.html"><code>Class</code></a>, <a href="../Array.html"><code>Array</code></a> of <a href="../Class.html"><code>Class</code></a> or Proc. When passed a Proc, an instance of the job will be passed as argument.</p>

<p>If the <code>:queue</code> option is specified, then only the job(s) enqueued to a specific queue will be performed.</p>

<pre><code>def test_perform_enqueued_jobs_with_queue
  perform_enqueued_jobs queue: :some_queue do
    MyJob.set(queue: :some_queue).perform_later(1, 2, 3) # will be performed
    HelloJob.set(queue: :other_queue).perform_later(1, 2, 3) # will not be performed
  end
  assert_performed_jobs 1
end
</code></pre>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-perform_enqueued_jobs_source')" id="l_method-i-perform_enqueued_jobs_source">show</a>
                
              </p>
              <div id="method-i-perform_enqueued_jobs_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File activejob/lib/active_job/test_helper.rb</span>
<span class="line-num">542</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">perform_enqueued_jobs</span>(<span class="ruby-value">only:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-value">except:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-value">queue:</span> <span class="ruby-keyword">nil</span>)
<span class="line-num">543</span>   <span class="ruby-keyword">return</span> <span class="ruby-identifier">flush_enqueued_jobs</span>(<span class="ruby-value">only:</span> <span class="ruby-identifier">only</span>, <span class="ruby-value">except:</span> <span class="ruby-identifier">except</span>, <span class="ruby-value">queue:</span> <span class="ruby-identifier">queue</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">block_given?</span>
<span class="line-num">544</span> 
<span class="line-num">545</span>   <span class="ruby-identifier">validate_option</span>(<span class="ruby-value">only:</span> <span class="ruby-identifier">only</span>, <span class="ruby-value">except:</span> <span class="ruby-identifier">except</span>)
<span class="line-num">546</span> 
<span class="line-num">547</span>   <span class="ruby-identifier">old_perform_enqueued_jobs</span> = <span class="ruby-identifier">queue_adapter</span>.<span class="ruby-identifier">perform_enqueued_jobs</span>
<span class="line-num">548</span>   <span class="ruby-identifier">old_perform_enqueued_at_jobs</span> = <span class="ruby-identifier">queue_adapter</span>.<span class="ruby-identifier">perform_enqueued_at_jobs</span>
<span class="line-num">549</span>   <span class="ruby-identifier">old_filter</span> = <span class="ruby-identifier">queue_adapter</span>.<span class="ruby-identifier">filter</span>
<span class="line-num">550</span>   <span class="ruby-identifier">old_reject</span> = <span class="ruby-identifier">queue_adapter</span>.<span class="ruby-identifier">reject</span>
<span class="line-num">551</span>   <span class="ruby-identifier">old_queue</span> = <span class="ruby-identifier">queue_adapter</span>.<span class="ruby-identifier">queue</span>
<span class="line-num">552</span> 
<span class="line-num">553</span>   <span class="ruby-keyword">begin</span>
<span class="line-num">554</span>     <span class="ruby-identifier">queue_adapter</span>.<span class="ruby-identifier">perform_enqueued_jobs</span> = <span class="ruby-keyword">true</span>
<span class="line-num">555</span>     <span class="ruby-identifier">queue_adapter</span>.<span class="ruby-identifier">perform_enqueued_at_jobs</span> = <span class="ruby-keyword">true</span>
<span class="line-num">556</span>     <span class="ruby-identifier">queue_adapter</span>.<span class="ruby-identifier">filter</span> = <span class="ruby-identifier">only</span>
<span class="line-num">557</span>     <span class="ruby-identifier">queue_adapter</span>.<span class="ruby-identifier">reject</span> = <span class="ruby-identifier">except</span>
<span class="line-num">558</span>     <span class="ruby-identifier">queue_adapter</span>.<span class="ruby-identifier">queue</span> = <span class="ruby-identifier">queue</span>
<span class="line-num">559</span> 
<span class="line-num">560</span>     <span class="ruby-keyword">yield</span>
<span class="line-num">561</span>   <span class="ruby-keyword">ensure</span>
<span class="line-num">562</span>     <span class="ruby-identifier">queue_adapter</span>.<span class="ruby-identifier">perform_enqueued_jobs</span> = <span class="ruby-identifier">old_perform_enqueued_jobs</span>
<span class="line-num">563</span>     <span class="ruby-identifier">queue_adapter</span>.<span class="ruby-identifier">perform_enqueued_at_jobs</span> = <span class="ruby-identifier">old_perform_enqueued_at_jobs</span>
<span class="line-num">564</span>     <span class="ruby-identifier">queue_adapter</span>.<span class="ruby-identifier">filter</span> = <span class="ruby-identifier">old_filter</span>
<span class="line-num">565</span>     <span class="ruby-identifier">queue_adapter</span>.<span class="ruby-identifier">reject</span> = <span class="ruby-identifier">old_reject</span>
<span class="line-num">566</span>     <span class="ruby-identifier">queue_adapter</span>.<span class="ruby-identifier">queue</span> = <span class="ruby-identifier">old_queue</span>
<span class="line-num">567</span>   <span class="ruby-keyword">end</span>
<span class="line-num">568</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-queue_adapter">
            
              <b>queue_adapter</b>()
            
            <a href="../../classes/ActiveJob/TestHelper.html#method-i-queue_adapter" name="method-i-queue_adapter" class="permalink">Link</a>
          </div>

          
            <div class="description">
              <p>Accesses the <a href="TestHelper.html#method-i-queue_adapter"><code>queue_adapter</code></a> set by <a href="Base.html"><code>ActiveJob::Base</code></a>.</p>

<pre><code>def test_assert_job_has_custom_queue_adapter_set
  assert_instance_of CustomQueueAdapter, HelloJob.queue_adapter
end
</code></pre>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-queue_adapter_source')" id="l_method-i-queue_adapter_source">show</a>
                
              </p>
              <div id="method-i-queue_adapter_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File activejob/lib/active_job/test_helper.rb</span>
<span class="line-num">575</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">queue_adapter</span>
<span class="line-num">576</span>   <span class="ruby-constant">ActiveJob</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">queue_adapter</span>
<span class="line-num">577</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-queue_adapter_for_test">
            
              <b>queue_adapter_for_test</b>()
            
            <a href="../../classes/ActiveJob/TestHelper.html#method-i-queue_adapter_for_test" name="method-i-queue_adapter_for_test" class="permalink">Link</a>
          </div>

          
            <div class="description">
              <p>Specifies the queue adapter to use with all Active Job test helpers.</p>

<p>Returns an instance of the queue adapter and defaults to <code>ActiveJob::QueueAdapters::TestAdapter</code>.</p>

<p>Note: The adapter provided by this method must provide some additional methods from those expected of a standard <code>ActiveJob::QueueAdapter</code> in order to be used with the active job test helpers. Refer to <code>ActiveJob::QueueAdapters::TestAdapter</code>.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-queue_adapter_for_test_source')" id="l_method-i-queue_adapter_for_test_source">show</a>
                
              </p>
              <div id="method-i-queue_adapter_for_test_source" class="dyn-source">
                <pre>   <span class="ruby-comment"># File activejob/lib/active_job/test_helper.rb</span>
<span class="line-num">63</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">queue_adapter_for_test</span>
<span class="line-num">64</span>   <span class="ruby-constant">ActiveJob</span><span class="ruby-operator">::</span><span class="ruby-constant">QueueAdapters</span><span class="ruby-operator">::</span><span class="ruby-constant">TestAdapter</span>.<span class="ruby-identifier">new</span>
<span class="line-num">65</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
      
    
  
</div>

    </div>
  </body>
</html>
