<!DOCTYPE html>
<html lang="en">
<head>
    <title>CHANGELOG.md</title>
    <meta charset="UTF-8" />
    <link rel="stylesheet" href="../../css/reset.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../../css/main.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../../css/github.css" type="text/css" media="screen" />
<script src="../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
<script src="../../js/main.js" type="text/javascript" charset="utf-8"></script>
<script src="../../js/highlight.pack.js" type="text/javascript" charset="utf-8"></script>

</head>

<body>
    <div class="banner">
        
        <h1>
            CHANGELOG.md
        </h1>
        <ul class="files">
            
            <li>
                actionpack/CHANGELOG.md
                
                    <a href="https://github.com/rails/rails/blob/f33d52c95217212cbacc8d5e44b5a8e3cdc6f5b3/actionpack/CHANGELOG.md" target="_blank" class="github_url">on GitHub</a>
                
            </li>
            <li>Last modified: 2019-12-31 20:52:59 +0100</li>
        </ul>
    </div>

    <div id="bodyContent">
        <div id="content">
  
    <div class="description">
      
<h2 id="label-Rails+6.0.2.1+-28December+18-2C+2019-29"><a href="../../classes/Rails.html"><code>Rails</code></a> 6.0.2.1 (December 18, 2019)</h2>
<ul><li>
<p>Fix possible information leak / session hijacking vulnerability.</p>

<p>The <code>ActionDispatch::Session::MemcacheStore</code> is still vulnerable given it requires the gem dalli to be updated as well.</p>

<p>CVE-2019-16782.</p>
</li></ul>

<h2 id="label-Rails+6.0.2+-28December+13-2C+2019-29"><a href="../../classes/Rails.html"><code>Rails</code></a> 6.0.2 (December 13, 2019)</h2>
<ul><li>
<p>Allow using mountable engine route helpers in System Tests.</p>

<p><em>Chalo Fernandez</em></p>
</li></ul>

<h2 id="label-Rails+6.0.1+-28November+5-2C+2019-29"><a href="../../classes/Rails.html"><code>Rails</code></a> 6.0.1 (November 5, 2019)</h2>
<ul><li>
<p><code>ActionDispatch::SystemTestCase</code> now inherits from <code>ActiveSupport::TestCase</code> rather than <code>ActionDispatch::IntegrationTest</code>. This permits running jobs in system tests.</p>

<p><em>George Claghorn</em>, <em>Edouard Chin</em></p>
</li><li>
<p>Registered MIME types may contain extra flags:</p>

<pre><code>Mime::Type.register &quot;text/html; fragment&quot;, :html_fragment
</code></pre>

<p><em>Aaron Patterson</em></p>
</li></ul>

<h2 id="label-Rails+6.0.0+-28August+16-2C+2019-29"><a href="../../classes/Rails.html"><code>Rails</code></a> 6.0.0 (August 16, 2019)</h2>
<ul><li>
<p>No changes.</p>
</li></ul>

<h2 id="label-Rails+6.0.0.rc2+-28July+22-2C+2019-29"><a href="../../classes/Rails.html"><code>Rails</code></a> 6.0.0.rc2 (July 22, 2019)</h2>
<ul><li>
<p>Add the ability to set the CSP nonce only to the specified directives.</p>

<p>Fixes #35137.</p>

<p><em>Yuji Yaginuma</em></p>
</li><li>
<p>Keep part when scope option has value.</p>

<p>When a route was defined within an optional scope, if that route didn&#39;t take parameters the scope was lost when using path helpers. This commit ensures scope is kept both when the route takes parameters or when it doesn&#39;t.</p>

<p>Fixes #33219</p>

<p><em>Alberto Almagro</em></p>
</li><li>
<p>Change <code>ActionDispatch::Response#content_type</code> to return Content-Type header as it is.</p>

<p>Previously, <code>ActionDispatch::Response#content_type</code> returned value does NOT contain charset part. This behavior changed to returned Content-Type header containing charset part as it is.</p>

<p>If you want just MIME type, please use <code>ActionDispatch::Response#media_type</code> instead.</p>

<p>Enable <code>action_dispatch.return_only_media_type_on_content_type</code> to use this change. If not enabled, <code>ActionDispatch::Response#content_type</code> returns the same value as before version, but its behavior is deprecate.</p>

<p><em>Yuji Yaginuma</em></p>
</li><li>
<p>Calling <code>ActionController::Parameters#transform_keys/!</code> without a block now returns an enumerator for the parameters instead of the underlying hash.</p>

<p><em>Eugene Kenny</em></p>
</li><li>
<p>Fix a bug where DebugExceptions throws an error when malformed query parameters are provided</p>

<p><em>Yuki Nishijima</em>, <em>Stan Lo</em></p>
</li></ul>

<h2 id="label-Rails+6.0.0.rc1+-28April+24-2C+2019-29"><a href="../../classes/Rails.html"><code>Rails</code></a> 6.0.0.rc1 (April 24, 2019)</h2>
<ul><li>
<p>Make system tests take a failed screenshot in a <code>before_teardown</code> hook rather than an <code>after_teardown</code> hook.</p>

<p>This helps minimize the time gap between when an assertion fails and when the screenshot is taken (reducing the time in which the page could have been dynamically updated after the assertion failed).</p>

<p><em>Richard Macklin</em></p>
</li><li>
<p>Introduce <code>ActionDispatch::ActionableExceptions</code>.</p>

<p>The <code>ActionDispatch::ActionableExceptions</code> middleware dispatches actions from <code>ActiveSupport::ActionableError</code> descendants.</p>

<p>Actionable errors let&#39;s you dispatch actions from Rails&#39; error pages.</p>

<p><em>Vipul A M</em>, <em>Yao Jie</em>, <em>Genadi Samokovarov</em></p>
</li><li>
<p>Raise an <code>ArgumentError</code> if a resource custom param contains a colon (<code>:</code>).</p>

<p>After this change it&#39;s not possible anymore to configure routes like this:</p>

<pre><code>routes.draw do
  resources :users, param: &#39;name/:sneaky&#39;
end
</code></pre>

<p>Fixes #30467.</p>

<p><em>Josua Schmid</em></p>
</li></ul>

<h2 id="label-Rails+6.0.0.beta3+-28March+11-2C+2019-29"><a href="../../classes/Rails.html"><code>Rails</code></a> 6.0.0.beta3 (March 11, 2019)</h2>
<ul><li>
<p>No changes.</p>
</li></ul>

<h2 id="label-Rails+6.0.0.beta2+-28February+25-2C+2019-29"><a href="../../classes/Rails.html"><code>Rails</code></a> 6.0.0.beta2 (February 25, 2019)</h2>
<ul><li>
<p>Make debug exceptions works in an environment where ActiveStorage is not loaded.</p>

<p><em>Tomoyuki Kurosawa</em></p>
</li><li>
<p><code>ActionDispatch::SystemTestCase.driven_by</code> can now be called with a block to define specific browser capabilities.</p>

<p><em>Edouard Chin</em></p>
</li></ul>

<h2 id="label-Rails+6.0.0.beta1+-28January+18-2C+2019-29"><a href="../../classes/Rails.html"><code>Rails</code></a> 6.0.0.beta1 (January 18, 2019)</h2>
<ul><li>
<p>Remove deprecated <code>fragment_cache_key</code> helper in favor of <code>combined_fragment_cache_key</code>.</p>

<p><em>Rafael Mendonça França</em></p>
</li><li>
<p>Remove deprecated methods in <code>ActionDispatch::TestResponse</code>.</p>

<p><code>#success?</code>, <code>missing?</code> and <code>error?</code> were deprecated in <a href="../../classes/Rails.html"><code>Rails</code></a> 5.2 in favor of <code>#successful?</code>, <code>not_found?</code> and <code>server_error?</code>.</p>

<p><em>Rafael Mendonça França</em></p>
</li><li>
<p>Introduce <code>ActionDispatch::HostAuthorization</code>.</p>

<p>This is a new middleware that guards against DNS rebinding attacks by explicitly permitting the hosts a request can be made to.</p>

<p>Each host is checked with the case operator (<code>#===</code>) to support <code>Regexp</code>, <code>Proc</code>, <code>IPAddr</code> and custom objects as host allowances.</p>

<p><em>Genadi Samokovarov</em></p>
</li><li>
<p>Allow using <code>parsed_body</code> in <code>ActionController::TestCase</code>.</p>

<p>In addition to <code>ActionDispatch::IntegrationTest</code>, allow using <code>parsed_body</code> in <code>ActionController::TestCase</code>:</p>

<pre><code>class SomeControllerTest &lt; ActionController::TestCase
  def test_some_action
    post :action, body: { foo: &#39;bar&#39; }
    assert_equal({ &quot;foo&quot; =&gt; &quot;bar&quot; }, response.parsed_body)
  end
end
</code></pre>

<p>Fixes #34676.</p>

<p><em>Tobias Bühlmann</em></p>
</li><li>
<p>Raise an error on root route naming conflicts.</p>

<p>Raises an <code>ArgumentError</code> when multiple root routes are defined in the same context instead of assigning nil names to subsequent roots.</p>

<p><em>Gannon McGibbon</em></p>
</li><li>
<p>Allow rescue from parameter parse errors:</p>

<pre><code>rescue_from ActionDispatch::Http::Parameters::ParseError do
  head :unauthorized
end
</code></pre>

<p><em>Gannon McGibbon</em>, <em>Josh Cheek</em></p>
</li><li>
<p>Reset Capybara sessions if failed system test screenshot raising an exception.</p>

<p>Reset Capybara sessions if <code>take_failed_screenshot</code> raise exception in system test <code>after_teardown</code>.</p>

<p><em>Maxim Perepelitsa</em></p>
</li><li>
<p>Use request object for context if there&#39;s no controller</p>

<p>There is no controller instance when using a redirect route or a mounted rack application so pass the request object as the context when resolving dynamic CSP sources in this scenario.</p>

<p>Fixes #34200.</p>

<p><em>Andrew White</em></p>
</li><li>
<p>Apply mapping to symbols returned from dynamic CSP sources</p>

<p>Previously if a dynamic source returned a symbol such as :self it would be converted to a string implicitly, e.g:</p>

<pre><code>policy.default_src -&gt; { :self }
</code></pre>

<p>would generate the header:</p>

<pre><code>Content-Security-Policy: default-src self
</code></pre>

<p>and now it generates:</p>

<pre><code>Content-Security-Policy: default-src &#39;self&#39;
</code></pre>

<p><em>Andrew White</em></p>
</li><li>
<p>Add <code>ActionController::Parameters#each_value</code>.</p>

<p><em>Lukáš Zapletal</em></p>
</li><li>
<p>Deprecate <code>ActionDispatch::Http::ParameterFilter</code> in favor of <code>ActiveSupport::ParameterFilter</code>.</p>

<p><em>Yoshiyuki Kinjo</em></p>
</li><li>
<p>Encode Content-Disposition filenames on <code>send_data</code> and <code>send_file</code>. Previously, <code>send_data &#39;data&#39;, filename: &quot;\u{3042}.txt" sends "filename=\"\u{3042}.txt\"" as Content-Disposition and it can be garbled. Now it follows {RFC 2231}[https://tools.ietf.org/html/rfc2231]</code> and <a href="https://tools.ietf.org/html/rfc5987">RFC 5987</a> and sends <code>&quot;filename=\&quot;%3F.txt\&quot;; filename*=UTF-8&#39;&#39;%E3%81%82.txt&quot;</code>. Most browsers can find filename correctly and old browsers fallback to ASCII converted name.</p>

<p><em>Fumiaki Matsushima</em></p>
</li><li>
<p>Expose <code>ActionController::Parameters#each_key</code> which allows iterating over keys without allocating an array.</p>

<p><em>Richard Schneeman</em></p>
</li><li>
<p>Purpose metadata for signed/encrypted cookies.</p>

<p><a href="../../classes/Rails.html"><code>Rails</code></a> can now thwart attacks that attempt to copy signed/encrypted value of a cookie and use it as the value of another cookie.</p>

<p>It does so by stashing the cookie-name in the purpose field which is then signed/encrypted along with the cookie value. Then, on a server-side read, we verify the cookie-names and discard any attacked cookies.</p>

<p>Enable <code>action_dispatch.use_cookies_with_metadata</code> to use this feature, which writes cookies with the new purpose and expiry metadata embedded.</p>

<p><em>Assain Jaleel</em></p>
</li><li>
<p>Raises <code>ActionController::RespondToMismatchError</code> with conflicting <code>respond_to</code> invocations.</p>

<p><code>respond_to</code> can match multiple types and lead to undefined behavior when multiple invocations are made and the types do not match:</p>

<pre><code>respond_to do |outer_type|
  outer_type.js do
    respond_to do |inner_type|
      inner_type.html { render body: &quot;HTML&quot; }
    end
  end
end
</code></pre>

<p><em>Patrick Toomey</em></p>
</li><li>
<p><code>ActionDispatch::Http::UploadedFile</code> now delegates <code>to_path</code> to its tempfile.</p>

<p>This allows uploaded file objects to be passed directly to <code>File.read</code> without raising a <code>TypeError</code>:</p>

<pre><code>uploaded_file = ActionDispatch::Http::UploadedFile.new(tempfile: tmp_file)
File.read(uploaded_file)
</code></pre>

<p><em>Aaron Kromer</em></p>
</li><li>
<p>Pass along arguments to underlying <code>get</code> method in <code>follow_redirect!</code></p>

<p>Now all arguments passed to <code>follow_redirect!</code> are passed to the underlying <code>get</code> method. This for example allows to set custom headers for the redirection request to the server.</p>

<pre><code>follow_redirect!(params: { foo: :bar })
</code></pre>

<p><em>Remo Fritzsche</em></p>
</li><li>
<p>Introduce a new error page to when the implicit render page is accessed in the browser.</p>

<p>Now instead of showing an error page that with exception and backtraces we now show only one informative page.</p>

<p><em>Vinicius Stock</em></p>
</li><li>
<p>Introduce <code>ActionDispatch::DebugExceptions.register_interceptor</code>.</p>

<p><a href="../../classes/Exception.html"><code>Exception</code></a> aware plugin authors can use the newly introduced <code>.register_interceptor</code> method to get the processed exception, instead of monkey patching DebugExceptions.</p>

<pre><code>ActionDispatch::DebugExceptions.register_interceptor do |request, exception|
  HypoteticalPlugin.capture_exception(request, exception)
end
</code></pre>

<p><em>Genadi Samokovarov</em></p>
</li><li>
<p>Output only one Content-Security-Policy nonce header value per request.</p>

<p>Fixes #32597.</p>

<p><em>Andrey Novikov</em>, <em>Andrew White</em></p>
</li><li>
<p>Move default headers configuration into their own module that can be included in controllers.</p>

<p><em>Kevin Deisz</em></p>
</li><li>
<p>Add method <code>dig</code> to <code>session</code>.</p>

<p><em>claudiob</em>, <em>Takumi Shotoku</em></p>
</li><li>
<p>Controller level <code>force_ssl</code> has been deprecated in favor of <code>config.force_ssl</code>.</p>

<p><em>Derek Prior</em></p>
</li><li>
<p><a href="../../classes/Rails.html"><code>Rails</code></a> 6 requires Ruby 2.5.0 or newer.</p>

<p><em>Jeremy Daer</em>, <em>Kasper Timm Hansen</em></p>
</li></ul>

<p>Please check <a href="https://github.com/rails/rails/blob/5-2-stable/actionpack/CHANGELOG.md">5-2-stable</a> for previous changes.</p>

    </div>
  


  


  
  


  


  

  



  

    

    

    


    


    <!-- Methods -->
    
    
    
  
</div>

    </div>
  </body>
</html>
