<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>OpenSSL::Cipher</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link rel="stylesheet" href="../../css/reset.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../../css/main.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../../css/github.css" type="text/css" media="screen" />
<script src="../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
<script src="../../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
<script src="../../js/main.js" type="text/javascript" charset="utf-8"></script>
<script src="../../js/highlight.pack.js" type="text/javascript" charset="utf-8"></script>

</head>

<body>
    <div class="banner">
        
        <h1>
            <span class="type">Class</span>
            OpenSSL::Cipher
            
                <span class="parent">&lt;
                    
                    <a href="../Object.html">Object</a>
                    
                </span>
            
        </h1>
        <ul class="files">
            
            <li><a href="../../files/ext/openssl/lib/openssl/cipher_rb.html">ext/openssl/lib/openssl/cipher.rb</a></li>
            
            <li><a href="../../files/ext/openssl/ossl_c.html">ext/openssl/ossl.c</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
  
    <div class="description">
      
<p>Provides symmetric algorithms for encryption and decryption. The algorithms
that are available depend on the particular version of <a
href="../OpenSSL.html">OpenSSL</a> that is installed.</p>

<h3 id="class-OpenSSL::Cipher-label-Listing+all+supported+algorithms">Listing all supported algorithms</h3>

<p>A list of supported algorithms can be obtained by</p>

<pre><code>puts OpenSSL::Cipher.ciphers
</code></pre>

<h3 id="class-OpenSSL::Cipher-label-Instantiating+a+Cipher">Instantiating a <a href="Cipher/Cipher.html">Cipher</a></h3>

<p>There are several ways to create a <a href="Cipher/Cipher.html">Cipher</a>
instance. Generally, a <a href="Cipher/Cipher.html">Cipher</a> algorithm is
categorized by its name, the key length in bits and the cipher mode to be
used. The most generic way to create a <a
href="Cipher/Cipher.html">Cipher</a> is the following</p>

<pre><code>cipher = OpenSSL::Cipher.new(&#39;&lt;name&gt;-&lt;key length&gt;-&lt;mode&gt;&#39;)
</code></pre>

<p>That is, a string consisting of the hyphenated concatenation of the
individual components name, key length and mode. Either all uppercase or
all lowercase strings may be used, for example:</p>

<pre><code>cipher = OpenSSL::Cipher.new(&#39;AES-128-CBC&#39;)
</code></pre>

<p>For each algorithm supported, there is a class defined under the <a
href="Cipher/Cipher.html">Cipher</a> class that goes by the name of the
cipher, e.g. to obtain an instance of AES, you could also use</p>

<pre><code># these are equivalent
cipher = OpenSSL::Cipher::AES.new(128, :CBC)
cipher = OpenSSL::Cipher::AES.new(128, &#39;CBC&#39;)
cipher = OpenSSL::Cipher::AES.new(&#39;128-CBC&#39;)
</code></pre>

<p>Finally, due to its wide-spread use, there are also extra classes defined
for the different key sizes of AES</p>

<pre><code>cipher = OpenSSL::Cipher::AES128.new(:CBC)
cipher = OpenSSL::Cipher::AES192.new(:CBC)
cipher = OpenSSL::Cipher::AES256.new(:CBC)
</code></pre>

<h3 id="class-OpenSSL::Cipher-label-Choosing+either+encryption+or+decryption+mode">Choosing either encryption or decryption mode</h3>

<p>Encryption and decryption are often very similar operations for symmetric
algorithms, this is reflected by not having to choose different classes for
either operation, both can be done using the same class. Still, after
obtaining a <a href="Cipher/Cipher.html">Cipher</a> instance, we need to
tell the instance what it is that we intend to do with it, so we need to
call either</p>

<pre><code>cipher.encrypt
</code></pre>

<p>or</p>

<pre><code>cipher.decrypt
</code></pre>

<p>on the <a href="Cipher/Cipher.html">Cipher</a> instance. This should be the
first call after creating the instance, otherwise configuration that has
already been set could get lost in the process.</p>

<h3 id="class-OpenSSL::Cipher-label-Choosing+a+key">Choosing a key</h3>

<p>Symmetric encryption requires a key that is the same for the encrypting and
for the decrypting party and after initial key establishment should be kept
as private information. There are a lot of ways to create insecure keys,
the most notable is to simply take a password as the key without processing
the password further. A simple and secure way to create a key for a
particular <a href="Cipher/Cipher.html">Cipher</a> is</p>

<pre><code>cipher = OpenSSL::AES256.new(:CFB)
cipher.encrypt
key = cipher.random_key # also sets the generated key on the Cipher
</code></pre>

<p>If you absolutely need to use passwords as encryption keys, you should use
Password-Based Key Derivation Function 2 (PBKDF2) by generating the key
with the help of the functionality provided by <a
href="PKCS5.html#method-i-pbkdf2_hmac_sha1">OpenSSL::PKCS5#pbkdf2_hmac_sha1</a>
or <a
href="PKCS5.html#method-i-pbkdf2_hmac">OpenSSL::PKCS5#pbkdf2_hmac</a>.</p>

<p>Although there is <a
href="Cipher.html#method-i-pkcs5_keyivgen">#pkcs5_keyivgen</a>, its use is
deprecated and it should only be used in legacy applications because it
does not use the newer PKCS#5 v2 algorithms.</p>

<h3 id="class-OpenSSL::Cipher-label-Choosing+an+IV">Choosing an IV</h3>

<p>The cipher modes CBC, CFB, OFB and CTR all need an “initialization vector”,
or short, IV. ECB mode is the only mode that does not require an IV, but
there is almost no legitimate use case for this mode because of the fact
that it does not sufficiently hide plaintext patterns. Therefore</p>

<p><strong>You should never use ECB mode unless you are absolutely sure that
you absolutely need it</strong></p>

<p>Because of this, you will end up with a mode that explicitly requires an IV
in any case. Although the IV can be seen as public information, i.e. it may
be transmitted in public once generated, it should still stay unpredictable
to prevent certain kinds of attacks. Therefore, ideally</p>

<p><strong>Always create a secure random IV for every encryption of your <a
href="Cipher/Cipher.html">Cipher</a></strong></p>

<p>A new, random IV should be created for every encryption of data. Think of
the IV as a nonce (number used once) - it&#39;s public but random and
unpredictable. A secure random IV can be created as follows</p>

<pre><code>cipher = ...
cipher.encrypt
key = cipher.random_key
iv = cipher.random_iv # also sets the generated IV on the Cipher</code></pre>

<p>Although the key is generally a random value, too, it is a bad choice as an
IV. There are elaborate ways how an attacker can take advantage of such an
IV. As a general rule of thumb, exposing the key directly or indirectly
should be avoided at all cost and exceptions only be made with good reason.</p>

<h3 id="class-OpenSSL::Cipher-label-Calling+Cipher-23final">Calling <a href="Cipher.html#method-i-final">#final</a></h3>

<p>ECB (which should not be used) and CBC are both block-based modes. This
means that unlike for the other streaming-based modes, they operate on
fixed-size blocks of data, and therefore they require a “finalization” step
to produce or correctly decrypt the last block of data by appropriately
handling some form of padding. Therefore it is essential to add the output
of <a href="Cipher.html#method-i-final">#final</a> to your
encryption/decryption buffer or you will end up with decryption errors or
truncated data.</p>

<p>Although this is not really necessary for streaming-mode ciphers, it is
still recommended to apply the same pattern of adding the output of <a
href="Cipher.html#method-i-final">#final</a> there as well - it also
enables you to switch between modes more easily in the future.</p>

<h3 id="class-OpenSSL::Cipher-label-Encrypting+and+decrypting+some+data">Encrypting and decrypting some data</h3>

<pre><code>data = &quot;Very, very confidential data&quot;

cipher = OpenSSL::Cipher::AES.new(128, :CBC)
cipher.encrypt
key = cipher.random_key
iv = cipher.random_iv

encrypted = cipher.update(data) + cipher.final
...
decipher = OpenSSL::Cipher::AES.new(128, :CBC)
decipher.decrypt
decipher.key = key
decipher.iv = iv

plain = decipher.update(encrypted) + decipher.final

puts data == plain #=&gt; true</code></pre>

<h3 id="class-OpenSSL::Cipher-label-Authenticated+Encryption+and+Associated+Data+-28AEAD-29">Authenticated Encryption and Associated <a href="../Data.html">Data</a> (AEAD)</h3>

<p>If the <a href="../OpenSSL.html">OpenSSL</a> version used supports it, an
Authenticated Encryption mode (such as GCM or CCM) should always be
preferred over any unauthenticated mode. Currently, <a
href="../OpenSSL.html">OpenSSL</a> supports AE only in combination with
Associated <a href="../Data.html">Data</a> (AEAD) where additional
associated data is included in the encryption process to compute a tag at
the end of the encryption. This tag will also be used in the decryption
process and by verifying its validity, the authenticity of a given
ciphertext is established.</p>

<p>This is superior to unauthenticated modes in that it allows to detect if
somebody effectively changed the ciphertext after it had been encrypted.
This prevents malicious modifications of the ciphertext that could
otherwise be exploited to modify ciphertexts in ways beneficial to
potential attackers.</p>

<p>An associated data is used where there is additional information, such as
headers or some metadata, that must be also authenticated but not
necessarily need to be encrypted. If no associated data is needed for
encryption and later decryption, the <a href="../OpenSSL.html">OpenSSL</a>
library still requires a value to be set - “” may be used in case none is
available.</p>

<p>An example using the GCM (Galois/Counter Mode). You have 16 bytes
<em>key</em>, 12 bytes (96 bits) <em>nonce</em> and the associated data
<em>auth_data</em>. Be sure not to reuse the <em>key</em> and
<em>nonce</em> pair. Reusing an nonce ruins the security guarantees of GCM
mode.</p>

<pre><code>cipher = OpenSSL::Cipher::AES.new(128, :GCM).encrypt
cipher.key = key
cipher.iv = nonce
cipher.auth_data = auth_data

encrypted = cipher.update(data) + cipher.final
tag = cipher.auth_tag # produces 16 bytes tag by default
</code></pre>

<p>Now you are the receiver. You know the <em>key</em> and have received
<em>nonce</em>, <em>auth_data</em>, <em>encrypted</em> and <em>tag</em>
through an untrusted network. Note that GCM accepts an arbitrary length tag
between 1 and 16 bytes. You may additionally need to check that the
received tag has the correct length, or you allow attackers to forge a
valid single byte tag for the tampered ciphertext with a probability of
1/256.</p>

<pre><code>raise &quot;tag is truncated!&quot; unless tag.bytesize == 16
decipher = OpenSSL::Cipher::AES.new(128, :GCM).decrypt
decipher.key = key
decipher.iv = nonce
decipher.auth_tag = tag
decipher.auth_data = auth_data

decrypted = decipher.update(encrypted) + decipher.final

puts data == decrypted #=&gt; true
</code></pre>

    </div>
  


  


  
  


  
    <!-- Namespace -->
    <div class="sectiontitle">Namespace</div>
    <ul>
      
        <li>
          <span class="type">CLASS</span>
          <a href="Cipher/Cipher.html">OpenSSL::Cipher::Cipher</a>
        </li>
      
        <li>
          <span class="type">CLASS</span>
          <a href="Cipher/CipherError.html">OpenSSL::Cipher::CipherError</a>
        </li>
      
    </ul>
  


  
    <!-- Method ref -->
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
      
        <dt>A</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-auth_data-3D">auth_data=</a>,
              </li>
            
              
              <li>
                <a href="#method-i-auth_tag">auth_tag</a>,
              </li>
            
              
              <li>
                <a href="#method-i-auth_tag-3D">auth_tag=</a>,
              </li>
            
              
              <li>
                <a href="#method-i-auth_tag_len-3D">auth_tag_len=</a>,
              </li>
            
              
              <li>
                <a href="#method-i-authenticated-3F">authenticated?</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>B</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-block_size">block_size</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>C</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-c-ciphers">ciphers</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>D</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-decrypt">decrypt</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>E</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-encrypt">encrypt</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>F</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-final">final</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>I</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-initialize_copy">initialize_copy</a>,
              </li>
            
              
              <li>
                <a href="#method-i-iv-3D">iv=</a>,
              </li>
            
              
              <li>
                <a href="#method-i-iv_len">iv_len</a>,
              </li>
            
              
              <li>
                <a href="#method-i-iv_len-3D">iv_len=</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>K</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-key-3D">key=</a>,
              </li>
            
              
              <li>
                <a href="#method-i-key_len">key_len</a>,
              </li>
            
              
              <li>
                <a href="#method-i-key_len-3D">key_len=</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>N</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-name">name</a>,
              </li>
            
              
              <li>
                <a href="#method-c-new">new</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>P</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-padding-3D">padding=</a>,
              </li>
            
              
              <li>
                <a href="#method-i-pkcs5_keyivgen">pkcs5_keyivgen</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>R</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-random_iv">random_iv</a>,
              </li>
            
              
              <li>
                <a href="#method-i-random_key">random_key</a>,
              </li>
            
              
              <li>
                <a href="#method-i-reset">reset</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>U</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-update">update</a>
              </li>
            
          </ul>
        </dd>
      
    </dl>
  

  



  

    

    

    


    


    <!-- Methods -->
    
      <div class="sectiontitle">Class Public methods</div>
      
        <div class="method">
          <div class="title method-title" id="method-c-ciphers">
            
              <b>OpenSSL::Cipher.ciphers &rarr; array[string...]
</b>
            
            <a href="../../classes/OpenSSL/Cipher.html#method-c-ciphers" name="method-c-ciphers" class="permalink">Link</a>
          </div>

          
            <div class="description">
              <p>Returns the names of all available ciphers in an array.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-c-ciphers_source')" id="l_method-c-ciphers_source">show</a>
                
              </p>
              <div id="method-c-ciphers_source" class="dyn-source">
                <pre>static VALUE
ossl_s_ciphers(VALUE self)
{
    VALUE ary;

    ary = rb_ary_new();
    OBJ_NAME_do_all_sorted(OBJ_NAME_TYPE_CIPHER_METH,
                    (void(*)(const OBJ_NAME*,void*))add_cipher_name_to_ary,
                    (void*)ary);

    return ary;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-c-new">
            
              <b>Cipher.new(string) &rarr; cipher
</b>
            
            <a href="../../classes/OpenSSL/Cipher.html#method-c-new" name="method-c-new" class="permalink">Link</a>
          </div>

          
            <div class="description">
              <p>The string must be a valid cipher name like “AES-128-CBC” or “3DES”.</p>

<p>A list of cipher names is available by calling <a
href="Cipher.html#method-c-ciphers">::ciphers</a>.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-c-new_source')" id="l_method-c-new_source">show</a>
                
              </p>
              <div id="method-c-new_source" class="dyn-source">
                <pre>static VALUE
ossl_cipher_initialize(VALUE self, VALUE str)
{
    EVP_CIPHER_CTX *ctx;
    const EVP_CIPHER *cipher;
    char *name;

    name = StringValueCStr(str);
    GetCipherInit(self, ctx);
    if (ctx) {
        ossl_raise(rb_eRuntimeError, &quot;Cipher already initialized!&quot;);
    }
    AllocCipher(self, ctx);
    if (!(cipher = EVP_get_cipherbyname(name))) {
        ossl_raise(rb_eRuntimeError, &quot;unsupported cipher algorithm (%&quot;PRIsVALUE&quot;)&quot;, str);
    }
    if (EVP_CipherInit_ex(ctx, cipher, NULL, NULL, NULL, -1) != 1)
        ossl_raise(eCipherError, NULL);

    return self;
}</pre>
              </div>
            </div>
            
          </div>
                  
      <div class="sectiontitle">Instance Public methods</div>
      
        <div class="method">
          <div class="title method-title" id="method-i-auth_data-3D">
            
              <b>cipher.auth_data = string &rarr; string
</b>
            
            <a href="../../classes/OpenSSL/Cipher.html#method-i-auth_data-3D" name="method-i-auth_data-3D" class="permalink">Link</a>
          </div>

          
            <div class="description">
              <p>Sets the cipher&#39;s additional authenticated data. This field must be set
when using AEAD cipher modes such as GCM or CCM. If no associated data
shall be used, this method must <strong>still</strong> be called with a
value of “”. The contents of this field should be non-sensitive data which
will be added to the ciphertext to generate the authentication tag which
validates the contents of the ciphertext.</p>

<p>The AAD must be set prior to encryption or decryption. In encryption mode,
it must be set after calling <a
href="Cipher.html#method-i-encrypt">#encrypt</a> and setting <a
href="Cipher.html#method-i-key-3D">#key=</a> and <a
href="Cipher.html#method-i-iv-3D">#iv=</a>. When decrypting, the
authenticated data must be set after key, iv and especially
<strong>after</strong> the authentication tag has been set. I.e. set it
only after calling <a href="Cipher.html#method-i-decrypt">#decrypt</a>, <a
href="Cipher.html#method-i-key-3D">#key=</a>, <a
href="Cipher.html#method-i-iv-3D">#iv=</a> and <a
href="Cipher.html#method-i-auth_tag-3D">#auth_tag=</a> first.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-auth_data-3D_source')" id="l_method-i-auth_data-3D_source">show</a>
                
              </p>
              <div id="method-i-auth_data-3D_source" class="dyn-source">
                <pre>static VALUE
ossl_cipher_set_auth_data(VALUE self, VALUE data)
{
    EVP_CIPHER_CTX *ctx;
    unsigned char *in;
    long in_len, out_len;

    StringValue(data);

    in = (unsigned char *) RSTRING_PTR(data);
    in_len = RSTRING_LEN(data);

    GetCipher(self, ctx);
    if (!(EVP_CIPHER_flags(EVP_CIPHER_CTX_cipher(ctx)) &amp; EVP_CIPH_FLAG_AEAD_CIPHER))
        ossl_raise(eCipherError, &quot;AEAD not supported by this cipher&quot;);

    if (!ossl_cipher_update_long(ctx, NULL, &amp;out_len, in, in_len))
        ossl_raise(eCipherError, &quot;couldn&#39;t set additional authenticated data&quot;);

    return data;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-auth_tag">
            
              <b>cipher.auth_tag(tag_len = 16) &rarr; String
</b>
            
            <a href="../../classes/OpenSSL/Cipher.html#method-i-auth_tag" name="method-i-auth_tag" class="permalink">Link</a>
          </div>

          
            <div class="description">
              <p>Gets the authentication tag generated by Authenticated Encryption <a
href="Cipher/Cipher.html">Cipher</a> modes (GCM for example). This tag may
be stored along with the ciphertext, then set on the decryption cipher to
authenticate the contents of the ciphertext against changes. If the
optional integer parameter <em>tag_len</em> is given, the returned tag will
be <em>tag_len</em> bytes long. If the parameter is omitted, the default
length of 16 bytes or the length previously set by <a
href="Cipher.html#method-i-auth_tag_len-3D">auth_tag_len=</a> will be used.
For maximum security, the longest possible should be chosen.</p>

<p>The tag may only be retrieved after calling <a
href="Cipher.html#method-i-final">#final</a>.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-auth_tag_source')" id="l_method-i-auth_tag_source">show</a>
                
              </p>
              <div id="method-i-auth_tag_source" class="dyn-source">
                <pre>static VALUE
ossl_cipher_get_auth_tag(int argc, VALUE *argv, VALUE self)
{
    VALUE vtag_len, ret;
    EVP_CIPHER_CTX *ctx;
    int tag_len = 16;

    rb_scan_args(argc, argv, &quot;01&quot;, &amp;vtag_len);
    if (NIL_P(vtag_len))
        vtag_len = rb_attr_get(self, id_auth_tag_len);
    if (!NIL_P(vtag_len))
        tag_len = NUM2INT(vtag_len);

    GetCipher(self, ctx);

    if (!(EVP_CIPHER_flags(EVP_CIPHER_CTX_cipher(ctx)) &amp; EVP_CIPH_FLAG_AEAD_CIPHER))
        ossl_raise(eCipherError, &quot;authentication tag not supported by this cipher&quot;);

    ret = rb_str_new(NULL, tag_len);
    if (!EVP_CIPHER_CTX_ctrl(ctx, EVP_CTRL_AEAD_GET_TAG, tag_len, RSTRING_PTR(ret)))
        ossl_raise(eCipherError, &quot;retrieving the authentication tag failed&quot;);

    return ret;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-auth_tag-3D">
            
              <b>cipher.auth_tag = string &rarr; string
</b>
            
            <a href="../../classes/OpenSSL/Cipher.html#method-i-auth_tag-3D" name="method-i-auth_tag-3D" class="permalink">Link</a>
          </div>

          
            <div class="description">
              <p>Sets the authentication tag to verify the integrity of the ciphertext. This
can be called only when the cipher supports AE. The tag must be set after
calling <a href="Cipher.html#method-i-decrypt">#decrypt</a>, <a
href="Cipher.html#method-i-key-3D">#key=</a> and <a
href="Cipher.html#method-i-iv-3D">#iv=</a>, but before calling <a
href="Cipher.html#method-i-final">#final</a>. After all decryption is
performed, the tag is verified automatically in the call to <a
href="Cipher.html#method-i-final">#final</a>.</p>

<p>For OCB mode, the tag length must be supplied with <a
href="Cipher.html#method-i-auth_tag_len-3D">auth_tag_len=</a> beforehand.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-auth_tag-3D_source')" id="l_method-i-auth_tag-3D_source">show</a>
                
              </p>
              <div id="method-i-auth_tag-3D_source" class="dyn-source">
                <pre>static VALUE
ossl_cipher_set_auth_tag(VALUE self, VALUE vtag)
{
    EVP_CIPHER_CTX *ctx;
    unsigned char *tag;
    int tag_len;

    StringValue(vtag);
    tag = (unsigned char *) RSTRING_PTR(vtag);
    tag_len = RSTRING_LENINT(vtag);

    GetCipher(self, ctx);
    if (!(EVP_CIPHER_flags(EVP_CIPHER_CTX_cipher(ctx)) &amp; EVP_CIPH_FLAG_AEAD_CIPHER))
        ossl_raise(eCipherError, &quot;authentication tag not supported by this cipher&quot;);

    if (!EVP_CIPHER_CTX_ctrl(ctx, EVP_CTRL_AEAD_SET_TAG, tag_len, tag))
        ossl_raise(eCipherError, &quot;unable to set AEAD tag&quot;);

    return vtag;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-auth_tag_len-3D">
            
              <b>cipher.auth_tag_len = Integer &rarr; Integer
</b>
            
            <a href="../../classes/OpenSSL/Cipher.html#method-i-auth_tag_len-3D" name="method-i-auth_tag_len-3D" class="permalink">Link</a>
          </div>

          
            <div class="description">
              <p>Sets the length of the authentication tag to be generated or to be given
for AEAD ciphers that requires it as in input parameter. Note that not all
AEAD ciphers support this method.</p>

<p>In OCB mode, the length must be supplied both when encrypting and when
decrypting, and must be before specifying an IV.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-auth_tag_len-3D_source')" id="l_method-i-auth_tag_len-3D_source">show</a>
                
              </p>
              <div id="method-i-auth_tag_len-3D_source" class="dyn-source">
                <pre>static VALUE
ossl_cipher_set_auth_tag_len(VALUE self, VALUE vlen)
{
    int tag_len = NUM2INT(vlen);
    EVP_CIPHER_CTX *ctx;

    GetCipher(self, ctx);
    if (!(EVP_CIPHER_flags(EVP_CIPHER_CTX_cipher(ctx)) &amp; EVP_CIPH_FLAG_AEAD_CIPHER))
        ossl_raise(eCipherError, &quot;AEAD not supported by this cipher&quot;);

    if (!EVP_CIPHER_CTX_ctrl(ctx, EVP_CTRL_AEAD_SET_TAG, tag_len, NULL))
        ossl_raise(eCipherError, &quot;unable to set authentication tag length&quot;);

    /* for #auth_tag */
    rb_ivar_set(self, id_auth_tag_len, INT2NUM(tag_len));

    return vlen;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-authenticated-3F">
            
              <b>cipher.authenticated? &rarr; true | false
</b>
            
            <a href="../../classes/OpenSSL/Cipher.html#method-i-authenticated-3F" name="method-i-authenticated-3F" class="permalink">Link</a>
          </div>

          
            <div class="description">
              <p>Indicated whether this <a href="Cipher/Cipher.html">Cipher</a> instance
uses an Authenticated Encryption mode.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-authenticated-3F_source')" id="l_method-i-authenticated-3F_source">show</a>
                
              </p>
              <div id="method-i-authenticated-3F_source" class="dyn-source">
                <pre>static VALUE
ossl_cipher_is_authenticated(VALUE self)
{
    EVP_CIPHER_CTX *ctx;

    GetCipher(self, ctx);

    return (EVP_CIPHER_flags(EVP_CIPHER_CTX_cipher(ctx)) &amp; EVP_CIPH_FLAG_AEAD_CIPHER) ? Qtrue : Qfalse;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-block_size">
            
              <b>cipher.block_size &rarr; integer
</b>
            
            <a href="../../classes/OpenSSL/Cipher.html#method-i-block_size" name="method-i-block_size" class="permalink">Link</a>
          </div>

          
            <div class="description">
              <p>Returns the size in bytes of the blocks on which this <a
href="Cipher/Cipher.html">Cipher</a> operates on.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-block_size_source')" id="l_method-i-block_size_source">show</a>
                
              </p>
              <div id="method-i-block_size_source" class="dyn-source">
                <pre>static VALUE
ossl_cipher_block_size(VALUE self)
{
    EVP_CIPHER_CTX *ctx;

    GetCipher(self, ctx);

    return INT2NUM(EVP_CIPHER_CTX_block_size(ctx));
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-decrypt">
            
              <b>cipher.decrypt &rarr; self
</b>
            
            <a href="../../classes/OpenSSL/Cipher.html#method-i-decrypt" name="method-i-decrypt" class="permalink">Link</a>
          </div>

          
            <div class="description">
              <p>Initializes the <a href="Cipher/Cipher.html">Cipher</a> for decryption.</p>

<p>Make sure to call <a href="Cipher.html#method-i-encrypt">#encrypt</a> or <a
href="Cipher.html#method-i-decrypt">#decrypt</a> before using any of the
following methods:</p>
<ul><li><dl class="rdoc-list label-list"><dt><a href="Cipher.html#method-i-key-3D">key=</a>, <a href="Cipher.html#method-i-iv-3D">iv=</a>, <a href="Cipher.html#method-i-random_key">random_key</a>, <a href="Cipher.html#method-i-random_iv">random_iv</a>, <a href="Cipher.html#method-i-pkcs5_keyivgen">pkcs5_keyivgen</a>
<dd></dd></dl>
</li></ul>

<p>Internally calls EVP_CipherInit_ex(ctx, NULL, NULL, NULL, NULL, 0).</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-decrypt_source')" id="l_method-i-decrypt_source">show</a>
                
              </p>
              <div id="method-i-decrypt_source" class="dyn-source">
                <pre>static VALUE
ossl_cipher_decrypt(int argc, VALUE *argv, VALUE self)
{
    return ossl_cipher_init(argc, argv, self, 0);
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-encrypt">
            
              <b>cipher.encrypt &rarr; self
</b>
            
            <a href="../../classes/OpenSSL/Cipher.html#method-i-encrypt" name="method-i-encrypt" class="permalink">Link</a>
          </div>

          
            <div class="description">
              <p>Initializes the <a href="Cipher/Cipher.html">Cipher</a> for encryption.</p>

<p>Make sure to call <a href="Cipher.html#method-i-encrypt">#encrypt</a> or <a
href="Cipher.html#method-i-decrypt">#decrypt</a> before using any of the
following methods:</p>
<ul><li><dl class="rdoc-list label-list"><dt><a href="Cipher.html#method-i-key-3D">key=</a>, <a href="Cipher.html#method-i-iv-3D">iv=</a>, <a href="Cipher.html#method-i-random_key">random_key</a>, <a href="Cipher.html#method-i-random_iv">random_iv</a>, <a href="Cipher.html#method-i-pkcs5_keyivgen">pkcs5_keyivgen</a>
<dd></dd></dl>
</li></ul>

<p>Internally calls EVP_CipherInit_ex(ctx, NULL, NULL, NULL, NULL, 1).</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-encrypt_source')" id="l_method-i-encrypt_source">show</a>
                
              </p>
              <div id="method-i-encrypt_source" class="dyn-source">
                <pre>static VALUE
ossl_cipher_encrypt(int argc, VALUE *argv, VALUE self)
{
    return ossl_cipher_init(argc, argv, self, 1);
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-final">
            
              <b>cipher.final &rarr; string
</b>
            
            <a href="../../classes/OpenSSL/Cipher.html#method-i-final" name="method-i-final" class="permalink">Link</a>
          </div>

          
            <div class="description">
              <p>Returns the remaining data held in the cipher object. Further calls to <a
href="Cipher.html#method-i-update">#update</a> or <a
href="Cipher.html#method-i-final">#final</a> will return garbage. This call
should always be made as the last call of an encryption or decryption
operation, after having fed the entire plaintext or ciphertext to the <a
href="Cipher/Cipher.html">Cipher</a> instance.</p>

<p>If an authenticated cipher was used, a <a
href="Cipher/CipherError.html">CipherError</a> is raised if the tag could
not be authenticated successfully. Only call this method after setting the
authentication tag and passing the entire contents of the ciphertext into
the cipher.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-final_source')" id="l_method-i-final_source">show</a>
                
              </p>
              <div id="method-i-final_source" class="dyn-source">
                <pre>static VALUE
ossl_cipher_final(VALUE self)
{
    EVP_CIPHER_CTX *ctx;
    int out_len;
    VALUE str;

    GetCipher(self, ctx);
    str = rb_str_new(0, EVP_CIPHER_CTX_block_size(ctx));
    if (!EVP_CipherFinal_ex(ctx, (unsigned char *)RSTRING_PTR(str), &amp;out_len))
        ossl_raise(eCipherError, NULL);
    assert(out_len &lt;= RSTRING_LEN(str));
    rb_str_set_len(str, out_len);

    return str;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-initialize_copy">
            
              <b>initialize_copy</b>(p1)
            
            <a href="../../classes/OpenSSL/Cipher.html#method-i-initialize_copy" name="method-i-initialize_copy" class="permalink">Link</a>
          </div>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-initialize_copy_source')" id="l_method-i-initialize_copy_source">show</a>
                
              </p>
              <div id="method-i-initialize_copy_source" class="dyn-source">
                <pre>static VALUE
ossl_cipher_copy(VALUE self, VALUE other)
{
    EVP_CIPHER_CTX *ctx1, *ctx2;

    rb_check_frozen(self);
    if (self == other) return self;

    GetCipherInit(self, ctx1);
    if (!ctx1) {
        AllocCipher(self, ctx1);
    }
    GetCipher(other, ctx2);
    if (EVP_CIPHER_CTX_copy(ctx1, ctx2) != 1)
        ossl_raise(eCipherError, NULL);

    return self;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-iv-3D">
            
              <b>cipher.iv = string &rarr; string
</b>
            
            <a href="../../classes/OpenSSL/Cipher.html#method-i-iv-3D" name="method-i-iv-3D" class="permalink">Link</a>
          </div>

          
            <div class="description">
              <p>Sets the cipher IV. Please note that since you should never be using ECB
mode, an IV is always explicitly required and should be set prior to
encryption. The IV itself can be safely transmitted in public, but it
should be unpredictable to prevent certain kinds of attacks. You may use <a
href="Cipher.html#method-i-random_iv">#random_iv</a> to create a secure
random IV.</p>

<p>Only call this method after calling <a
href="Cipher.html#method-i-encrypt">#encrypt</a> or <a
href="Cipher.html#method-i-decrypt">#decrypt</a>.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-iv-3D_source')" id="l_method-i-iv-3D_source">show</a>
                
              </p>
              <div id="method-i-iv-3D_source" class="dyn-source">
                <pre>static VALUE
ossl_cipher_set_iv(VALUE self, VALUE iv)
{
    EVP_CIPHER_CTX *ctx;
    int iv_len = 0;

    StringValue(iv);
    GetCipher(self, ctx);

    if (EVP_CIPHER_flags(EVP_CIPHER_CTX_cipher(ctx)) &amp; EVP_CIPH_FLAG_AEAD_CIPHER)
        iv_len = (int)(VALUE)EVP_CIPHER_CTX_get_app_data(ctx);
    if (!iv_len)
        iv_len = EVP_CIPHER_CTX_iv_length(ctx);
    if (RSTRING_LEN(iv) != iv_len)
        ossl_raise(rb_eArgError, &quot;iv must be %d bytes&quot;, iv_len);

    if (EVP_CipherInit_ex(ctx, NULL, NULL, NULL, (unsigned char *)RSTRING_PTR(iv), -1) != 1)
        ossl_raise(eCipherError, NULL);

    return iv;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-iv_len">
            
              <b>cipher.iv_len &rarr; integer
</b>
            
            <a href="../../classes/OpenSSL/Cipher.html#method-i-iv_len" name="method-i-iv_len" class="permalink">Link</a>
          </div>

          
            <div class="description">
              <p>Returns the expected length in bytes for an IV for this <a
href="Cipher/Cipher.html">Cipher</a>.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-iv_len_source')" id="l_method-i-iv_len_source">show</a>
                
              </p>
              <div id="method-i-iv_len_source" class="dyn-source">
                <pre>static VALUE
ossl_cipher_iv_length(VALUE self)
{
    EVP_CIPHER_CTX *ctx;
    int len = 0;

    GetCipher(self, ctx);
    if (EVP_CIPHER_flags(EVP_CIPHER_CTX_cipher(ctx)) &amp; EVP_CIPH_FLAG_AEAD_CIPHER)
        len = (int)(VALUE)EVP_CIPHER_CTX_get_app_data(ctx);
    if (!len)
        len = EVP_CIPHER_CTX_iv_length(ctx);

    return INT2NUM(len);
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-iv_len-3D">
            
              <b>cipher.iv_len = integer &rarr; integer
</b>
            
            <a href="../../classes/OpenSSL/Cipher.html#method-i-iv_len-3D" name="method-i-iv_len-3D" class="permalink">Link</a>
          </div>

          
            <div class="description">
              <p>Sets the IV/nonce length of the <a href="Cipher/Cipher.html">Cipher</a>.
Normally block ciphers don&#39;t allow changing the IV length, but some
make use of IV for &#39;nonce&#39;. You may need this for interoperability
with other applications.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-iv_len-3D_source')" id="l_method-i-iv_len-3D_source">show</a>
                
              </p>
              <div id="method-i-iv_len-3D_source" class="dyn-source">
                <pre>static VALUE
ossl_cipher_set_iv_length(VALUE self, VALUE iv_length)
{
    int len = NUM2INT(iv_length);
    EVP_CIPHER_CTX *ctx;

    GetCipher(self, ctx);
    if (!(EVP_CIPHER_flags(EVP_CIPHER_CTX_cipher(ctx)) &amp; EVP_CIPH_FLAG_AEAD_CIPHER))
        ossl_raise(eCipherError, &quot;cipher does not support AEAD&quot;);

    if (!EVP_CIPHER_CTX_ctrl(ctx, EVP_CTRL_AEAD_SET_IVLEN, len, NULL))
        ossl_raise(eCipherError, &quot;unable to set IV length&quot;);

    /*
     * EVP_CIPHER_CTX_iv_length() returns the default length. So we need to save
     * the length somewhere. Luckily currently we aren&#39;t using app_data.
     */
    EVP_CIPHER_CTX_set_app_data(ctx, (void *)(VALUE)len);

    return iv_length;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-key-3D">
            
              <b>cipher.key = string &rarr; string
</b>
            
            <a href="../../classes/OpenSSL/Cipher.html#method-i-key-3D" name="method-i-key-3D" class="permalink">Link</a>
          </div>

          
            <div class="description">
              <p>Sets the cipher key. To generate a key, you should either use a secure
random byte string or, if the key is to be derived from a password, you
should rely on PBKDF2 functionality provided by <a
href="PKCS5.html">OpenSSL::PKCS5</a>. To generate a secure random-based
key, <a href="Cipher.html#method-i-random_key">#random_key</a> may be used.</p>

<p>Only call this method after calling <a
href="Cipher.html#method-i-encrypt">#encrypt</a> or <a
href="Cipher.html#method-i-decrypt">#decrypt</a>.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-key-3D_source')" id="l_method-i-key-3D_source">show</a>
                
              </p>
              <div id="method-i-key-3D_source" class="dyn-source">
                <pre>static VALUE
ossl_cipher_set_key(VALUE self, VALUE key)
{
    EVP_CIPHER_CTX *ctx;
    int key_len;

    StringValue(key);
    GetCipher(self, ctx);

    key_len = EVP_CIPHER_CTX_key_length(ctx);
    if (RSTRING_LEN(key) != key_len)
        ossl_raise(rb_eArgError, &quot;key must be %d bytes&quot;, key_len);

    if (EVP_CipherInit_ex(ctx, NULL, NULL, (unsigned char *)RSTRING_PTR(key), NULL, -1) != 1)
        ossl_raise(eCipherError, NULL);

    rb_ivar_set(self, id_key_set, Qtrue);

    return key;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-key_len">
            
              <b>cipher.key_len &rarr; integer
</b>
            
            <a href="../../classes/OpenSSL/Cipher.html#method-i-key_len" name="method-i-key_len" class="permalink">Link</a>
          </div>

          
            <div class="description">
              <p>Returns the key length in bytes of the <a
href="Cipher/Cipher.html">Cipher</a>.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-key_len_source')" id="l_method-i-key_len_source">show</a>
                
              </p>
              <div id="method-i-key_len_source" class="dyn-source">
                <pre>static VALUE
ossl_cipher_key_length(VALUE self)
{
    EVP_CIPHER_CTX *ctx;

    GetCipher(self, ctx);

    return INT2NUM(EVP_CIPHER_CTX_key_length(ctx));
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-key_len-3D">
            
              <b>cipher.key_len = integer &rarr; integer
</b>
            
            <a href="../../classes/OpenSSL/Cipher.html#method-i-key_len-3D" name="method-i-key_len-3D" class="permalink">Link</a>
          </div>

          
            <div class="description">
              <p>Sets the key length of the cipher.  If the cipher is a fixed length cipher
then attempting to set the key length to any value other than the fixed
value is an error.</p>

<p>Under normal circumstances you do not need to call this method (and
probably shouldn&#39;t).</p>

<p>See EVP_CIPHER_CTX_set_key_length for further information.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-key_len-3D_source')" id="l_method-i-key_len-3D_source">show</a>
                
              </p>
              <div id="method-i-key_len-3D_source" class="dyn-source">
                <pre>static VALUE
ossl_cipher_set_key_length(VALUE self, VALUE key_length)
{
    int len = NUM2INT(key_length);
    EVP_CIPHER_CTX *ctx;

    GetCipher(self, ctx);
    if (EVP_CIPHER_CTX_set_key_length(ctx, len) != 1)
        ossl_raise(eCipherError, NULL);

    return key_length;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-name">
            
              <b>cipher.name &rarr; string
</b>
            
            <a href="../../classes/OpenSSL/Cipher.html#method-i-name" name="method-i-name" class="permalink">Link</a>
          </div>

          
            <div class="description">
              <p>Returns the name of the cipher which may differ slightly from the original
name provided.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-name_source')" id="l_method-i-name_source">show</a>
                
              </p>
              <div id="method-i-name_source" class="dyn-source">
                <pre>static VALUE
ossl_cipher_name(VALUE self)
{
    EVP_CIPHER_CTX *ctx;

    GetCipher(self, ctx);

    return rb_str_new2(EVP_CIPHER_name(EVP_CIPHER_CTX_cipher(ctx)));
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-padding-3D">
            
              <b>cipher.padding = integer &rarr; integer
</b>
            
            <a href="../../classes/OpenSSL/Cipher.html#method-i-padding-3D" name="method-i-padding-3D" class="permalink">Link</a>
          </div>

          
            <div class="description">
              <p>Enables or disables padding. By default encryption operations are padded
using standard block padding and the padding is checked and removed when
decrypting. If the pad parameter is zero then no padding is performed, the
total amount of data encrypted or decrypted must then be a multiple of the
block size or an error will occur.</p>

<p>See EVP_CIPHER_CTX_set_padding for further information.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-padding-3D_source')" id="l_method-i-padding-3D_source">show</a>
                
              </p>
              <div id="method-i-padding-3D_source" class="dyn-source">
                <pre>static VALUE
ossl_cipher_set_padding(VALUE self, VALUE padding)
{
    EVP_CIPHER_CTX *ctx;
    int pad = NUM2INT(padding);

    GetCipher(self, ctx);
    if (EVP_CIPHER_CTX_set_padding(ctx, pad) != 1)
        ossl_raise(eCipherError, NULL);
    return padding;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-pkcs5_keyivgen">
            
              <b>cipher.pkcs5_keyivgen(pass, salt = nil, iterations = 2048, digest = "MD5") &rarr; nil
</b>
            
            <a href="../../classes/OpenSSL/Cipher.html#method-i-pkcs5_keyivgen" name="method-i-pkcs5_keyivgen" class="permalink">Link</a>
          </div>

          
            <div class="description">
              <p>Generates and sets the key/IV based on a password.</p>

<p><strong>WARNING</strong>: This method is only <a
href="PKCS5.html">PKCS5</a> v1.5 compliant when using RC2, RC4-40, or DES
with MD5 or SHA1. Using anything else (like AES) will generate the key/iv
using an <a href="../OpenSSL.html">OpenSSL</a> specific method. This method
is deprecated and should no longer be used. Use a <a
href="PKCS5.html">PKCS5</a> v2 key generation method from <a
href="PKCS5.html">OpenSSL::PKCS5</a> instead.</p>

<h3 id="method-i-pkcs5_keyivgen-label-Parameters">Parameters</h3>
<ul><li>
<p><em>salt</em> must be an 8 byte string if provided.</p>
</li><li>
<p><em>iterations</em> is an integer with a default of 2048.</p>
</li><li>
<p><em>digest</em> is a <a href="Digest.html">Digest</a> object that defaults
to &#39;MD5&#39;</p>
</li></ul>

<p>A minimum of 1000 iterations is recommended.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-pkcs5_keyivgen_source')" id="l_method-i-pkcs5_keyivgen_source">show</a>
                
              </p>
              <div id="method-i-pkcs5_keyivgen_source" class="dyn-source">
                <pre>static VALUE
ossl_cipher_pkcs5_keyivgen(int argc, VALUE *argv, VALUE self)
{
    EVP_CIPHER_CTX *ctx;
    const EVP_MD *digest;
    VALUE vpass, vsalt, viter, vdigest;
    unsigned char key[EVP_MAX_KEY_LENGTH], iv[EVP_MAX_IV_LENGTH], *salt = NULL;
    int iter;

    rb_scan_args(argc, argv, &quot;13&quot;, &amp;vpass, &amp;vsalt, &amp;viter, &amp;vdigest);
    StringValue(vpass);
    if(!NIL_P(vsalt)){
        StringValue(vsalt);
        if(RSTRING_LEN(vsalt) != PKCS5_SALT_LEN)
            ossl_raise(eCipherError, &quot;salt must be an 8-octet string&quot;);
        salt = (unsigned char *)RSTRING_PTR(vsalt);
    }
    iter = NIL_P(viter) ? 2048 : NUM2INT(viter);
    if (iter &lt;= 0)
        rb_raise(rb_eArgError, &quot;iterations must be a positive integer&quot;);
    digest = NIL_P(vdigest) ? EVP_md5() : ossl_evp_get_digestbyname(vdigest);
    GetCipher(self, ctx);
    EVP_BytesToKey(EVP_CIPHER_CTX_cipher(ctx), digest, salt,
                   (unsigned char *)RSTRING_PTR(vpass), RSTRING_LENINT(vpass), iter, key, iv);
    if (EVP_CipherInit_ex(ctx, NULL, NULL, key, iv, -1) != 1)
        ossl_raise(eCipherError, NULL);
    OPENSSL_cleanse(key, sizeof key);
    OPENSSL_cleanse(iv, sizeof iv);

    rb_ivar_set(self, id_key_set, Qtrue);

    return Qnil;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-random_iv">
            
              <b>cipher.random_iv &rarr; iv
</b>
            
            <a href="../../classes/OpenSSL/Cipher.html#method-i-random_iv" name="method-i-random_iv" class="permalink">Link</a>
          </div>

          
            <div class="description">
              <p>Generate a random IV with <a
href="Random.html#method-c-random_bytes">OpenSSL::Random.random_bytes</a>
and sets it to the cipher, and returns it.</p>

<p>You must call <a href="Cipher.html#method-i-encrypt">encrypt</a> or <a
href="Cipher.html#method-i-decrypt">decrypt</a> before calling this method.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-random_iv_source')" id="l_method-i-random_iv_source">show</a>
                
              </p>
              <div id="method-i-random_iv_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ext/openssl/lib/openssl/cipher.rb, line 55</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">random_iv</span>
  <span class="ruby-identifier">str</span> = <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">Random</span>.<span class="ruby-identifier">random_bytes</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">iv_len</span>)
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">iv</span> = <span class="ruby-identifier">str</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-random_key">
            
              <b>cipher.random_key &rarr; key
</b>
            
            <a href="../../classes/OpenSSL/Cipher.html#method-i-random_key" name="method-i-random_key" class="permalink">Link</a>
          </div>

          
            <div class="description">
              <p>Generate a random key with <a
href="Random.html#method-c-random_bytes">OpenSSL::Random.random_bytes</a>
and sets it to the cipher, and returns it.</p>

<p>You must call <a href="Cipher.html#method-i-encrypt">encrypt</a> or <a
href="Cipher.html#method-i-decrypt">decrypt</a> before calling this method.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-random_key_source')" id="l_method-i-random_key_source">show</a>
                
              </p>
              <div id="method-i-random_key_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ext/openssl/lib/openssl/cipher.rb, line 43</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">random_key</span>
  <span class="ruby-identifier">str</span> = <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">Random</span>.<span class="ruby-identifier">random_bytes</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">key_len</span>)
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">key</span> = <span class="ruby-identifier">str</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-reset">
            
              <b>cipher.reset &rarr; self
</b>
            
            <a href="../../classes/OpenSSL/Cipher.html#method-i-reset" name="method-i-reset" class="permalink">Link</a>
          </div>

          
            <div class="description">
              <p>Fully resets the internal state of the <a
href="Cipher/Cipher.html">Cipher</a>. By using this, the same <a
href="Cipher/Cipher.html">Cipher</a> instance may be used several times for
encryption or decryption tasks.</p>

<p>Internally calls EVP_CipherInit_ex(ctx, NULL, NULL, NULL, NULL, -1).</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-reset_source')" id="l_method-i-reset_source">show</a>
                
              </p>
              <div id="method-i-reset_source" class="dyn-source">
                <pre>static VALUE
ossl_cipher_reset(VALUE self)
{
    EVP_CIPHER_CTX *ctx;

    GetCipher(self, ctx);
    if (EVP_CipherInit_ex(ctx, NULL, NULL, NULL, NULL, -1) != 1)
        ossl_raise(eCipherError, NULL);

    return self;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-update">
            
              <b>cipher.update(data [, buffer]) &rarr; string or buffer
</b>
            
            <a href="../../classes/OpenSSL/Cipher.html#method-i-update" name="method-i-update" class="permalink">Link</a>
          </div>

          
            <div class="description">
              <p>Encrypts data in a streaming fashion. Hand consecutive blocks of data to
the <a href="Cipher.html#method-i-update">update</a> method in order to
encrypt it. Returns the encrypted data chunk. When done, the output of <a
href="Cipher.html#method-i-final">#final</a> should be additionally added
to the result.</p>

<p>If <em>buffer</em> is given, the encryption/decryption result will be
written to it. <em>buffer</em> will be resized automatically.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-update_source')" id="l_method-i-update_source">show</a>
                
              </p>
              <div id="method-i-update_source" class="dyn-source">
                <pre>static VALUE
ossl_cipher_update(int argc, VALUE *argv, VALUE self)
{
    EVP_CIPHER_CTX *ctx;
    unsigned char *in;
    long in_len, out_len;
    VALUE data, str;

    rb_scan_args(argc, argv, &quot;11&quot;, &amp;data, &amp;str);

    if (!RTEST(rb_attr_get(self, id_key_set)))
        ossl_raise(eCipherError, &quot;key not set&quot;);

    StringValue(data);
    in = (unsigned char *)RSTRING_PTR(data);
    if ((in_len = RSTRING_LEN(data)) == 0)
        ossl_raise(rb_eArgError, &quot;data must not be empty&quot;);
    GetCipher(self, ctx);
    out_len = in_len+EVP_CIPHER_CTX_block_size(ctx);
    if (out_len &lt;= 0) {
        ossl_raise(rb_eRangeError,
                   &quot;data too big to make output buffer: %ld bytes&quot;, in_len);
    }

    if (NIL_P(str)) {
        str = rb_str_new(0, out_len);
    } else {
        StringValue(str);
        rb_str_resize(str, out_len);
    }

    if (!ossl_cipher_update_long(ctx, (unsigned char *)RSTRING_PTR(str), &amp;out_len, in, in_len))
        ossl_raise(eCipherError, NULL);
    assert(out_len &lt; RSTRING_LEN(str));
    rb_str_set_len(str, out_len);

    return str;
}</pre>
              </div>
            </div>
            
          </div>
                    </div>

    </div>
  </body>
</html>
