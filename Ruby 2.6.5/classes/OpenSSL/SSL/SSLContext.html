<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>OpenSSL::SSL::SSLContext</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link rel="stylesheet" href="../../../css/reset.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../../../css/main.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../../../css/github.css" type="text/css" media="screen" />
<script src="../../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
<script src="../../../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
<script src="../../../js/main.js" type="text/javascript" charset="utf-8"></script>
<script src="../../../js/highlight.pack.js" type="text/javascript" charset="utf-8"></script>

</head>

<body>
    <div class="banner">
        
        <h1>
            <span class="type">Class</span>
            OpenSSL::SSL::SSLContext
            
                <span class="parent">&lt;
                    
                    <a href="../../Object.html">Object</a>
                    
                </span>
            
        </h1>
        <ul class="files">
            
            <li><a href="../../../files/ext/openssl/lib/openssl/ssl_rb.html">ext/openssl/lib/openssl/ssl.rb</a></li>
            
            <li><a href="../../../files/ext/openssl/ossl_ssl_c.html">ext/openssl/ossl_ssl.c</a></li>
            
            <li><a href="../../../files/lib/net/ftp_rb.html">lib/net/ftp.rb</a></li>
            
            <li><a href="../../../files/lib/net/http_rb.html">lib/net/http.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
  
    <div class="description">
      
<p>An <a href="SSLContext.html">SSLContext</a> is used to set various options
regarding certificates, algorithms, verification, session caching, etc. 
The <a href="SSLContext.html">SSLContext</a> is used to create an <a
href="SSLSocket.html">SSLSocket</a>.</p>

<p>All attributes must be set before creating an <a
href="SSLSocket.html">SSLSocket</a> as the <a
href="SSLContext.html">SSLContext</a> will be frozen afterward.</p>

    </div>
  


  


  
  


  


  
    <!-- Method ref -->
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
      
        <dt>A</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-add_certificate">add_certificate</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>C</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-ciphers">ciphers</a>,
              </li>
            
              
              <li>
                <a href="#method-i-ciphers-3D">ciphers=</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>E</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-ecdh_curves-3D">ecdh_curves=</a>,
              </li>
            
              
              <li>
                <a href="#method-i-enable_fallback_scsv">enable_fallback_scsv</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>F</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-flush_sessions">flush_sessions</a>,
              </li>
            
              
              <li>
                <a href="#method-i-freeze">freeze</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>M</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-max_version-3D">max_version=</a>,
              </li>
            
              
              <li>
                <a href="#method-i-min_version-3D">min_version=</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>N</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-c-new">new</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>O</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-options">options</a>,
              </li>
            
              
              <li>
                <a href="#method-i-options-3D">options=</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>S</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-security_level">security_level</a>,
              </li>
            
              
              <li>
                <a href="#method-i-security_level-3D">security_level=</a>,
              </li>
            
              
              <li>
                <a href="#method-i-session_add">session_add</a>,
              </li>
            
              
              <li>
                <a href="#method-i-session_cache_mode">session_cache_mode</a>,
              </li>
            
              
              <li>
                <a href="#method-i-session_cache_mode-3D">session_cache_mode=</a>,
              </li>
            
              
              <li>
                <a href="#method-i-session_cache_size">session_cache_size</a>,
              </li>
            
              
              <li>
                <a href="#method-i-session_cache_size-3D">session_cache_size=</a>,
              </li>
            
              
              <li>
                <a href="#method-i-session_cache_stats">session_cache_stats</a>,
              </li>
            
              
              <li>
                <a href="#method-i-session_remove">session_remove</a>,
              </li>
            
              
              <li>
                <a href="#method-i-set_params">set_params</a>,
              </li>
            
              
              <li>
                <a href="#method-i-setup">setup</a>,
              </li>
            
              
              <li>
                <a href="#method-i-ssl_version-3D">ssl_version=</a>
              </li>
            
          </ul>
        </dd>
      
    </dl>
  

  



  

    

    

    
      <!-- Section constants -->
      <div class="sectiontitle">Constants</div>
      <table border='0' cellpadding='5'>
        
          <tr valign='top'>
            <td class="attr-name">DEFAULT_PARAMS</td>
            <td>=</td>
            <td class="attr-value">{ # :nodoc:
:min_version =&gt; OpenSSL::SSL::TLS1_VERSION,
:verify_mode =&gt; OpenSSL::SSL::VERIFY_PEER,
:verify_hostname =&gt; true,
:options =&gt; -&gt; {
opts = OpenSSL::SSL::OP_ALL
opts &amp;= ~OpenSSL::SSL::OP_DONT_INSERT_EMPTY_FRAGMENTS
opts |= OpenSSL::SSL::OP_NO_COMPRESSION
opts
}.call
}</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">DEFAULT_2048</td>
            <td>=</td>
            <td class="attr-value">OpenSSL::PKey::DH.new &lt;&lt;-_end_of_pem_
-----BEGIN DH PARAMETERS-----
MIIBCAKCAQEA7E6kBrYiyvmKAMzQ7i8WvwVk9Y/+f8S7sCTN712KkK3cqd1jhJDY
JbrYeNV3kUIKhPxWHhObHKpD1R84UpL+s2b55+iMd6GmL7OYmNIT/FccKhTcveab
VBmZT86BZKYyf45hUF9FOuUM9xPzuK3Vd8oJQvfYMCd7LPC0taAEljQLR4Edf8E6
YoaOffgTf5qxiwkjnlVZQc3whgnEt9FpVMvQ9eknyeGB5KHfayAc3+hUAvI3/Cr3
1bNveX5wInh5GDx1FGhKBZ+s1H+aedudCm7sCgRwv8lKWYGiHzObSma8A86KG+MD
7Lo5JquQ3DlBodj3IDyPrxIv96lvRPFtAwIBAg==
-----END DH PARAMETERS-----
_end_of_pem_</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">DEFAULT_TMP_DH_CALLBACK</td>
            <td>=</td>
            <td class="attr-value">lambda { |ctx, is_export, keylen| # :nodoc:
warn &quot;using default DH parameters.&quot; if $VERBOSE
DEFAULT_2048
}</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">DEFAULT_CERT_STORE</td>
            <td>=</td>
            <td class="attr-value">OpenSSL::X509::Store.new # :nodoc:</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">METHODS_MAP</td>
            <td>=</td>
            <td class="attr-value">{
SSLv23: 0,
SSLv2: OpenSSL::SSL::SSL2_VERSION,
SSLv3: OpenSSL::SSL::SSL3_VERSION,
TLSv1: OpenSSL::SSL::TLS1_VERSION,
TLSv1_1: OpenSSL::SSL::TLS1_1_VERSION,
TLSv1_2: OpenSSL::SSL::TLS1_2_VERSION,
}.freeze</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">METHODS</td>
            <td>=</td>
            <td class="attr-value">METHODS_MAP.flat_map { |name,|
[name, :&quot;#{name}_client&quot;, :&quot;#{name}_server&quot;]
}.freeze</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"><p>The list of available SSL/TLS methods. This constant is only provided for
backwards compatibility.</p></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">SESSION_CACHE_OFF</td>
            <td>=</td>
            <td class="attr-value">LONG2NUM(SSL_SESS_CACHE_OFF)</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"><p>No session caching for client or server</p></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">SESSION_CACHE_CLIENT</td>
            <td>=</td>
            <td class="attr-value">LONG2NUM(SSL_SESS_CACHE_CLIENT)</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"><p>Client sessions are added to the session cache</p></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">SESSION_CACHE_SERVER</td>
            <td>=</td>
            <td class="attr-value">LONG2NUM(SSL_SESS_CACHE_SERVER)</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"><p>Server sessions are added to the session cache</p></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">SESSION_CACHE_BOTH</td>
            <td>=</td>
            <td class="attr-value">LONG2NUM(SSL_SESS_CACHE_BOTH)</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"><p>Both client and server sessions are added to the session cache</p></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">SESSION_CACHE_NO_AUTO_CLEAR</td>
            <td>=</td>
            <td class="attr-value">LONG2NUM(SSL_SESS_CACHE_NO_AUTO_CLEAR)</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"><p>Normally the session cache is checked for expired sessions every 255
connections.  Since this may lead to a delay that cannot be controlled, the
automatic flushing may be disabled and <a
href="SSLContext.html#method-i-flush_sessions">flush_sessions</a> can be
called explicitly.</p></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">SESSION_CACHE_NO_INTERNAL_LOOKUP</td>
            <td>=</td>
            <td class="attr-value">LONG2NUM(SSL_SESS_CACHE_NO_INTERNAL_LOOKUP)</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"><p>Always perform external lookups of sessions even if they are in the
internal cache.</p>

<p>This flag has no effect on clients</p></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">SESSION_CACHE_NO_INTERNAL_STORE</td>
            <td>=</td>
            <td class="attr-value">LONG2NUM(SSL_SESS_CACHE_NO_INTERNAL_STORE)</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"><p>Never automatically store sessions in the internal store.</p></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">SESSION_CACHE_NO_INTERNAL</td>
            <td>=</td>
            <td class="attr-value">LONG2NUM(SSL_SESS_CACHE_NO_INTERNAL)</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"><p>Enables both <a
href="SSLContext.html#SESSION_CACHE_NO_INTERNAL_LOOKUP">SESSION_CACHE_NO_INTERNAL_LOOKUP</a>
and <a
href="SSLContext.html#SESSION_CACHE_NO_INTERNAL_STORE">SESSION_CACHE_NO_INTERNAL_STORE</a>.</p></td>
            </tr>
          
        
      </table>
    


    
      <!-- Section attributes -->
      <div class="sectiontitle">Attributes</div>
      <table border='0' cellpadding='5'>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [RW]
            </td>
            <td class='attr-name'>alpn_protocols</td>
            <td class='attr-desc'><p>An <a href="../../Enumerable.html">Enumerable</a> of Strings. Each <a
href="../../String.html">String</a> represents a protocol to be advertised
as the list of supported protocols for Application-Layer Protocol
Negotiation. Supported in <a href="../../OpenSSL.html">OpenSSL</a> 1.0.2
and higher. Has no effect on the server side. If not set explicitly, the
ALPN extension will not be included in the handshake.</p>

<h3 id="attribute-i-alpn_protocols-label-Example">Example</h3>

<pre><code>ctx.alpn_protocols = [&quot;http/1.1&quot;, &quot;spdy/2&quot;, &quot;h2&quot;]
</code></pre></td>
          </tr>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [RW]
            </td>
            <td class='attr-name'>alpn_select_cb</td>
            <td class='attr-desc'><p>A callback invoked on the server side when the server needs to select a
protocol from the list sent by the client. Supported in <a
href="../../OpenSSL.html">OpenSSL</a> 1.0.2 and higher. The callback must
return a protocol of those advertised by the client. If none is acceptable,
raising an error in the callback will cause the handshake to fail. Not
setting this callback explicitly means not supporting the ALPN extension on
the server - any protocols advertised by the client will be ignored.</p>

<h3 id="attribute-i-alpn_select_cb-label-Example">Example</h3>

<pre><code>ctx.alpn_select_cb = lambda do |protocols|
  # inspect the protocols and select one
  protocols.first
end
</code></pre></td>
          </tr>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [RW]
            </td>
            <td class='attr-name'>ca_file</td>
            <td class='attr-desc'><p>The path to a file containing a PEM-format CA certificate</p></td>
          </tr>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [RW]
            </td>
            <td class='attr-name'>ca_path</td>
            <td class='attr-desc'><p>The path to a directory containing CA certificates in PEM format.</p>

<p>Files are looked up by subject&#39;s <a href="../X509.html">X509</a>
name&#39;s hash value.</p></td>
          </tr>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [RW]
            </td>
            <td class='attr-name'>cert</td>
            <td class='attr-desc'><p>Context certificate</p>

<p>The <em>cert</em>, <em>key</em>, and <em>extra_chain_cert</em> attributes
are deprecated. It is recommended to use <a
href="SSLContext.html#method-i-add_certificate">add_certificate</a>
instead.</p></td>
          </tr>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [RW]
            </td>
            <td class='attr-name'>cert_store</td>
            <td class='attr-desc'><p>An <a href="../X509/Store.html">OpenSSL::X509::Store</a> used for
certificate verification.</p></td>
          </tr>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [RW]
            </td>
            <td class='attr-name'>client_ca</td>
            <td class='attr-desc'><p>A certificate or <a href="../../Array.html">Array</a> of certificates that
will be sent to the client.</p></td>
          </tr>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [RW]
            </td>
            <td class='attr-name'>client_cert_cb</td>
            <td class='attr-desc'><p>A callback invoked when a client certificate is requested by a server and
no certificate has been set.</p>

<p>The callback is invoked with a <a href="Session.html">Session</a> and must
return an <a href="../../Array.html">Array</a> containing an <a
href="../X509/Certificate.html">OpenSSL::X509::Certificate</a> and an <a
href="../PKey.html">OpenSSL::PKey</a>.  If any other value is returned the
handshake is suspended.</p></td>
          </tr>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [RW]
            </td>
            <td class='attr-name'>extra_chain_cert</td>
            <td class='attr-desc'><p>An <a href="../../Array.html">Array</a> of extra <a
href="../X509.html">X509</a> certificates to be added to the certificate
chain.</p>

<p>The <em>cert</em>, <em>key</em>, and <em>extra_chain_cert</em> attributes
are deprecated. It is recommended to use <a
href="SSLContext.html#method-i-add_certificate">add_certificate</a>
instead.</p></td>
          </tr>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [RW]
            </td>
            <td class='attr-name'>key</td>
            <td class='attr-desc'><p>Context private key</p>

<p>The <em>cert</em>, <em>key</em>, and <em>extra_chain_cert</em> attributes
are deprecated. It is recommended to use <a
href="SSLContext.html#method-i-add_certificate">add_certificate</a>
instead.</p></td>
          </tr>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [RW]
            </td>
            <td class='attr-name'>npn_protocols</td>
            <td class='attr-desc'><p>An <a href="../../Enumerable.html">Enumerable</a> of Strings. Each <a
href="../../String.html">String</a> represents a protocol to be advertised
as the list of supported protocols for Next Protocol Negotiation. Supported
in <a href="../../OpenSSL.html">OpenSSL</a> 1.0.1 and higher. Has no effect
on the client side. If not set explicitly, the NPN extension will not be
sent by the server in the handshake.</p>

<h3 id="attribute-i-npn_protocols-label-Example">Example</h3>

<pre><code>ctx.npn_protocols = [&quot;http/1.1&quot;, &quot;spdy/2&quot;]
</code></pre></td>
          </tr>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [RW]
            </td>
            <td class='attr-name'>npn_select_cb</td>
            <td class='attr-desc'><p>A callback invoked on the client side when the client needs to select a
protocol from the list sent by the server. Supported in <a
href="../../OpenSSL.html">OpenSSL</a> 1.0.1 and higher. The client MUST
select a protocol of those advertised by the server. If none is acceptable,
raising an error in the callback will cause the handshake to fail. Not
setting this callback explicitly means not supporting the NPN extension on
the client - any protocols advertised by the server will be ignored.</p>

<h3 id="attribute-i-npn_select_cb-label-Example">Example</h3>

<pre><code>ctx.npn_select_cb = lambda do |protocols|
  # inspect the protocols and select one
  protocols.first
end
</code></pre></td>
          </tr>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [RW]
            </td>
            <td class='attr-name'>renegotiation_cb</td>
            <td class='attr-desc'><p>A callback invoked whenever a new handshake is initiated. May be used to
disable renegotiation entirely.</p>

<p>The callback is invoked with the active <a
href="SSLSocket.html">SSLSocket</a>. The callback&#39;s return value is
irrelevant, normal return indicates “approval” of the renegotiation and
will continue the process. To forbid renegotiation and to cancel the
process, an Error may be raised within the callback.</p>

<h3 id="attribute-i-renegotiation_cb-label-Disable+client+renegotiation">Disable client renegotiation</h3>

<p>When running a server, it is often desirable to disable client
renegotiation entirely. You may use a callback as follows to implement this
feature:</p>

<pre><code>num_handshakes = 0
ctx.renegotiation_cb = lambda do |ssl|
  num_handshakes += 1
  raise RuntimeError.new(&quot;Client renegotiation disabled&quot;) if num_handshakes &gt; 1
end
</code></pre></td>
          </tr>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [RW]
            </td>
            <td class='attr-name'>servername_cb</td>
            <td class='attr-desc'><p>A callback invoked at connect time to distinguish between multiple server
names.</p>

<p>The callback is invoked with an <a href="SSLSocket.html">SSLSocket</a> and
a server name.  The callback must return an <a
href="SSLContext.html">SSLContext</a> for the server name or nil.</p></td>
          </tr>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [RW]
            </td>
            <td class='attr-name'>session_get_cb</td>
            <td class='attr-desc'><p>A callback invoked on a server when a session is proposed by the client but
the session could not be found in the server&#39;s internal cache.</p>

<p>The callback is invoked with the <a href="SSLSocket.html">SSLSocket</a> and
session id.  The callback may return a <a href="Session.html">Session</a>
from an external cache.</p></td>
          </tr>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [RW]
            </td>
            <td class='attr-name'>session_id_context</td>
            <td class='attr-desc'><p>Sets the context in which a session can be reused.  This allows sessions
for multiple applications to be distinguished, for example, by name.</p></td>
          </tr>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [RW]
            </td>
            <td class='attr-name'>session_new_cb</td>
            <td class='attr-desc'><p>A callback invoked when a new session was negotiated.</p>

<p>The callback is invoked with an <a href="SSLSocket.html">SSLSocket</a>.  If
<code>false</code> is returned the session will be removed from the
internal cache.</p></td>
          </tr>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [RW]
            </td>
            <td class='attr-name'>session_remove_cb</td>
            <td class='attr-desc'><p>A callback invoked when a session is removed from the internal cache.</p>

<p>The callback is invoked with an <a href="SSLContext.html">SSLContext</a>
and a <a href="Session.html">Session</a>.</p>

<p>IMPORTANT NOTE: It is currently not possible to use this safely in a
multi-threaded application. The callback is called inside a global lock and
it can randomly cause deadlock on Ruby thread switching.</p></td>
          </tr>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [RW]
            </td>
            <td class='attr-name'>ssl_timeout</td>
            <td class='attr-desc'><p>Maximum session lifetime in seconds.</p></td>
          </tr>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [RW]
            </td>
            <td class='attr-name'>timeout</td>
            <td class='attr-desc'><p>Maximum session lifetime in seconds.</p></td>
          </tr>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [RW]
            </td>
            <td class='attr-name'>tmp_dh_callback</td>
            <td class='attr-desc'><p>A callback invoked when DH parameters are required.</p>

<p>The callback is invoked with the <a href="Session.html">Session</a> for the
key exchange, an flag indicating the use of an export cipher and the
keylength required.</p>

<p>The callback must return an <a href="../PKey/DH.html">OpenSSL::PKey::DH</a>
instance of the correct key length.</p></td>
          </tr>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [RW]
            </td>
            <td class='attr-name'>tmp_ecdh_callback</td>
            <td class='attr-desc'><p>A callback invoked when ECDH parameters are required.</p>

<p>The callback is invoked with the <a href="Session.html">Session</a> for the
key exchange, an flag indicating the use of an export cipher and the
keylength required.</p>

<p>The callback is deprecated. This does not work with recent versions of <a
href="../../OpenSSL.html">OpenSSL</a>. Use <a
href="SSLContext.html#method-i-ecdh_curves-3D">#ecdh_curves=</a> instead.</p></td>
          </tr>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [RW]
            </td>
            <td class='attr-name'>verify_callback</td>
            <td class='attr-desc'><p>A callback for additional certificate verification.  The callback is
invoked for each certificate in the chain.</p>

<p>The callback is invoked with two values.  <em>preverify_ok</em> indicates
indicates if the verification was passed (<code>true</code>) or not
(<code>false</code>). <em>store_context</em> is an <a
href="../X509/StoreContext.html">OpenSSL::X509::StoreContext</a> containing
the context used for certificate verification.</p>

<p>If the callback returns <code>false</code>, the chain verification is
immediately stopped and a bad_certificate alert is then sent.</p></td>
          </tr>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [RW]
            </td>
            <td class='attr-name'>verify_depth</td>
            <td class='attr-desc'><p>Number of CA certificates to walk when verifying a certificate chain.</p></td>
          </tr>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [RW]
            </td>
            <td class='attr-name'>verify_hostname</td>
            <td class='attr-desc'><p>Whether to check the server certificate is valid for the hostname.</p>

<p>In order to make this work, <a
href="SSLContext.html#attribute-i-verify_mode">#verify_mode</a> must be set
to VERIFY_PEER and the server hostname must be given by <a
href="SSLSocket.html#method-i-hostname-3D">OpenSSL::SSL::SSLSocket#hostname=</a>.</p></td>
          </tr>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [RW]
            </td>
            <td class='attr-name'>verify_mode</td>
            <td class='attr-desc'><p><a href="Session.html">Session</a> verification mode.</p>

<p>Valid modes are VERIFY_NONE, VERIFY_PEER, VERIFY_CLIENT_ONCE,
VERIFY_FAIL_IF_NO_PEER_CERT and defined on <a
href="../SSL.html">OpenSSL::SSL</a></p>

<p>The default mode is VERIFY_NONE, which does not perform any verification at
all.</p>

<p>See SSL_CTX_set_verify(3) for details.</p></td>
          </tr>
        
      </table>
    


    <!-- Methods -->
    
      <div class="sectiontitle">Class Public methods</div>
      
        <div class="method">
          <div class="title method-title" id="method-c-new">
            
              <b>SSLContext.new           &rarr; ctx<br />SSLContext.new(:TLSv1)   &rarr; ctx<br />SSLContext.new("SSLv23") &rarr; ctx
</b>
            
            <a href="../../../classes/OpenSSL/SSL/SSLContext.html#method-c-new" name="method-c-new" class="permalink">Link</a>
          </div>

          
            <div class="description">
              <p>Creates a new <a href="../SSL.html">SSL</a> context.</p>

<p>If an argument is given, <a
href="SSLContext.html#method-i-ssl_version-3D">ssl_version=</a> is called
with the value. Note that this form is deprecated. New applications should
use <a href="SSLContext.html#method-i-min_version-3D">min_version=</a> and
<a href="SSLContext.html#method-i-max_version-3D">max_version=</a> as
necessary.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-c-new_source')" id="l_method-c-new_source">show</a>
                
              </p>
              <div id="method-c-new_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ext/openssl/lib/openssl/ssl.rb, line 121</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">initialize</span>(<span class="ruby-identifier">version</span> = <span class="ruby-keyword">nil</span>)
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">options</span> <span class="ruby-operator">|=</span> <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">SSL</span><span class="ruby-operator">::</span><span class="ruby-constant">OP_ALL</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">ssl_version</span> = <span class="ruby-identifier">version</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">version</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
                  
      <div class="sectiontitle">Instance Public methods</div>
      
        <div class="method">
          <div class="title method-title" id="method-i-add_certificate">
            
              <b>ctx.add_certificate(certiticate, pkey [, extra_certs]) &rarr; self
</b>
            
            <a href="../../../classes/OpenSSL/SSL/SSLContext.html#method-i-add_certificate" name="method-i-add_certificate" class="permalink">Link</a>
          </div>

          
            <div class="description">
              <p>Adds a certificate to the context. <em>pkey</em> must be a corresponding
private key with <em>certificate</em>.</p>

<p>Multiple certificates with different public key type can be added by
repeated calls of this method, and <a href="../../OpenSSL.html">OpenSSL</a>
will choose the most appropriate certificate during the handshake.</p>

<p><a href="SSLContext.html#attribute-i-cert">cert=</a>, <a
href="SSLContext.html#attribute-i-key">key=</a>, and <a
href="SSLContext.html#attribute-i-extra_chain_cert">extra_chain_cert=</a>
are old accessor methods for setting certificate and internally call this
method.</p>

<h3 id="method-i-add_certificate-label-Parameters">Parameters</h3>
<dl class="rdoc-list note-list"><dt><em>certificate</em>
<dd>
<p>A certificate. An instance of <a
href="../X509/Certificate.html">OpenSSL::X509::Certificate</a>.</p>
</dd><dt><em>pkey</em>
<dd>
<p>The private key for <em>certificate</em>. An instance of <a
href="../PKey/PKey.html">OpenSSL::PKey::PKey</a>.</p>
</dd><dt><em>extra_certs</em>
<dd>
<p>Optional. An array of <a
href="../X509/Certificate.html">OpenSSL::X509::Certificate</a>. When
sending a certificate chain, the certificates specified by this are sent
following <em>certificate</em>, in the order in the array.</p>
</dd></dl>

<h3 id="method-i-add_certificate-label-Example">Example</h3>

<pre><code>rsa_cert = OpenSSL::X509::Certificate.new(...)
rsa_pkey = OpenSSL::PKey.read(...)
ca_intermediate_cert = OpenSSL::X509::Certificate.new(...)
ctx.add_certificate(rsa_cert, rsa_pkey, [ca_intermediate_cert])

ecdsa_cert = ...
ecdsa_pkey = ...
another_ca_cert = ...
ctx.add_certificate(ecdsa_cert, ecdsa_pkey, [another_ca_cert])</code></pre>

<h3 id="method-i-add_certificate-label-Note">Note</h3>

<p><a href="../../OpenSSL.html">OpenSSL</a> before the version 1.0.2 could
handle only one extra chain across all key types. Calling this method
discards the chain set previously.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-add_certificate_source')" id="l_method-i-add_certificate_source">show</a>
                
              </p>
              <div id="method-i-add_certificate_source" class="dyn-source">
                <pre>static VALUE
ossl_sslctx_add_certificate(int argc, VALUE *argv, VALUE self)
{
    VALUE cert, key, extra_chain_ary;
    SSL_CTX *ctx;
    X509 *x509;
    STACK_OF(X509) *extra_chain = NULL;
    EVP_PKEY *pkey, *pub_pkey;

    GetSSLCTX(self, ctx);
    rb_scan_args(argc, argv, &quot;21&quot;, &amp;cert, &amp;key, &amp;extra_chain_ary);
    rb_check_frozen(self);
    x509 = GetX509CertPtr(cert);
    pkey = GetPrivPKeyPtr(key);

    /*
     * The reference counter is bumped, and decremented immediately.
     * X509_get0_pubkey() is only available in OpenSSL &gt;= 1.1.0.
     */
    pub_pkey = X509_get_pubkey(x509);
    EVP_PKEY_free(pub_pkey);
    if (!pub_pkey)
        rb_raise(rb_eArgError, &quot;certificate does not contain public key&quot;);
    if (EVP_PKEY_cmp(pub_pkey, pkey) != 1)
        rb_raise(rb_eArgError, &quot;public key mismatch&quot;);

    if (argc &gt;= 3)
        extra_chain = ossl_x509_ary2sk(extra_chain_ary);

    if (!SSL_CTX_use_certificate(ctx, x509)) {
        sk_X509_pop_free(extra_chain, X509_free);
        ossl_raise(eSSLError, &quot;SSL_CTX_use_certificate&quot;);
    }
    if (!SSL_CTX_use_PrivateKey(ctx, pkey)) {
        sk_X509_pop_free(extra_chain, X509_free);
        ossl_raise(eSSLError, &quot;SSL_CTX_use_PrivateKey&quot;);
    }

    if (extra_chain) {
#if OPENSSL_VERSION_NUMBER &gt;= 0x10002000 &amp;&amp; !defined(LIBRESSL_VERSION_NUMBER)
        if (!SSL_CTX_set0_chain(ctx, extra_chain)) {
            sk_X509_pop_free(extra_chain, X509_free);
            ossl_raise(eSSLError, &quot;SSL_CTX_set0_chain&quot;);
        }
#else
        STACK_OF(X509) *orig_extra_chain;
        X509 *x509_tmp;

        /* First, clear the existing chain */
        SSL_CTX_get_extra_chain_certs(ctx, &amp;orig_extra_chain);
        if (orig_extra_chain &amp;&amp; sk_X509_num(orig_extra_chain)) {
            rb_warning(&quot;SSL_CTX_set0_chain() is not available; &quot; \
                       &quot;clearing previously set certificate chain&quot;);
            SSL_CTX_clear_extra_chain_certs(ctx);
        }
        while ((x509_tmp = sk_X509_shift(extra_chain))) {
            /* Transfers ownership */
            if (!SSL_CTX_add_extra_chain_cert(ctx, x509_tmp)) {
                X509_free(x509_tmp);
                sk_X509_pop_free(extra_chain, X509_free);
                ossl_raise(eSSLError, &quot;SSL_CTX_add_extra_chain_cert&quot;);
            }
        }
        sk_X509_free(extra_chain);
#endif
    }
    return self;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-ciphers">
            
              <b>ctx.ciphers => [[name, version, bits, alg_bits], ...]
</b>
            
            <a href="../../../classes/OpenSSL/SSL/SSLContext.html#method-i-ciphers" name="method-i-ciphers" class="permalink">Link</a>
          </div>

          
            <div class="description">
              <p>The list of cipher suites configured for this context.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-ciphers_source')" id="l_method-i-ciphers_source">show</a>
                
              </p>
              <div id="method-i-ciphers_source" class="dyn-source">
                <pre>static VALUE
ossl_sslctx_get_ciphers(VALUE self)
{
    SSL_CTX *ctx;
    STACK_OF(SSL_CIPHER) *ciphers;
    const SSL_CIPHER *cipher;
    VALUE ary;
    int i, num;

    GetSSLCTX(self, ctx);
    ciphers = SSL_CTX_get_ciphers(ctx);
    if (!ciphers)
        return rb_ary_new();

    num = sk_SSL_CIPHER_num(ciphers);
    ary = rb_ary_new2(num);
    for(i = 0; i &lt; num; i++){
        cipher = sk_SSL_CIPHER_value(ciphers, i);
        rb_ary_push(ary, ossl_ssl_cipher_to_ary(cipher));
    }
    return ary;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-ciphers-3D">
            
              <b>ctx.ciphers = "cipher1:cipher2:..."<br />ctx.ciphers = [name, ...]<br />ctx.ciphers = [[name, version, bits, alg_bits], ...]
</b>
            
            <a href="../../../classes/OpenSSL/SSL/SSLContext.html#method-i-ciphers-3D" name="method-i-ciphers-3D" class="permalink">Link</a>
          </div>

          
            <div class="description">
              <p>Sets the list of available cipher suites for this context.  Note in a
server context some ciphers require the appropriate certificates.  For
example, an RSA cipher suite can only be chosen when an RSA certificate is
available.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-ciphers-3D_source')" id="l_method-i-ciphers-3D_source">show</a>
                
              </p>
              <div id="method-i-ciphers-3D_source" class="dyn-source">
                <pre>static VALUE
ossl_sslctx_set_ciphers(VALUE self, VALUE v)
{
    SSL_CTX *ctx;
    VALUE str, elem;
    int i;

    rb_check_frozen(self);
    if (NIL_P(v))
        return v;
    else if (RB_TYPE_P(v, T_ARRAY)) {
        str = rb_str_new(0, 0);
        for (i = 0; i &lt; RARRAY_LEN(v); i++) {
            elem = rb_ary_entry(v, i);
            if (RB_TYPE_P(elem, T_ARRAY)) elem = rb_ary_entry(elem, 0);
            elem = rb_String(elem);
            rb_str_append(str, elem);
            if (i &lt; RARRAY_LEN(v)-1) rb_str_cat2(str, &quot;:&quot;);
        }
    } else {
        str = v;
        StringValue(str);
    }

    GetSSLCTX(self, ctx);
    if (!SSL_CTX_set_cipher_list(ctx, StringValueCStr(str))) {
        ossl_raise(eSSLError, &quot;SSL_CTX_set_cipher_list&quot;);
    }

    return v;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-ecdh_curves-3D">
            
              <b>ctx.ecdh_curves = curve_list &rarr; curve_list
</b>
            
            <a href="../../../classes/OpenSSL/SSL/SSLContext.html#method-i-ecdh_curves-3D" name="method-i-ecdh_curves-3D" class="permalink">Link</a>
          </div>

          
            <div class="description">
              <p>Sets the list of “supported elliptic curves” for this context.</p>

<p>For a TLS client, the list is directly used in the Supported Elliptic
Curves Extension. For a server, the list is used by <a
href="../../OpenSSL.html">OpenSSL</a> to determine the set of shared
curves. <a href="../../OpenSSL.html">OpenSSL</a> will pick the most
appropriate one from it.</p>

<p>Note that this works differently with old <a
href="../../OpenSSL.html">OpenSSL</a> (&lt;= 1.0.1). Only one curve can be
set, and this has no effect for TLS clients.</p>

<h3 id="method-i-ecdh_curves-3D-label-Example">Example</h3>

<pre><code>ctx1 = OpenSSL::SSL::SSLContext.new
ctx1.ecdh_curves = &quot;X25519:P-256:P-224&quot;
svr = OpenSSL::SSL::SSLServer.new(tcp_svr, ctx1)
Thread.new { svr.accept }

ctx2 = OpenSSL::SSL::SSLContext.new
ctx2.ecdh_curves = &quot;P-256&quot;
cli = OpenSSL::SSL::SSLSocket.new(tcp_sock, ctx2)
cli.connect

p cli.tmp_key.group.curve_name
# =&gt; &quot;prime256v1&quot; (is an alias for NIST P-256)
</code></pre>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-ecdh_curves-3D_source')" id="l_method-i-ecdh_curves-3D_source">show</a>
                
              </p>
              <div id="method-i-ecdh_curves-3D_source" class="dyn-source">
                <pre>static VALUE
ossl_sslctx_set_ecdh_curves(VALUE self, VALUE arg)
{
    SSL_CTX *ctx;

    rb_check_frozen(self);
    GetSSLCTX(self, ctx);
    StringValueCStr(arg);

#if defined(HAVE_SSL_CTX_SET1_CURVES_LIST)
    if (!SSL_CTX_set1_curves_list(ctx, RSTRING_PTR(arg)))
        ossl_raise(eSSLError, NULL);
#else
    /* OpenSSL does not have SSL_CTX_set1_curves_list()... Fallback to
     * SSL_CTX_set_tmp_ecdh(). So only the first curve is used. */
    {
        VALUE curve, splitted;
        EC_KEY *ec;
        int nid;

        splitted = rb_str_split(arg, &quot;:&quot;);
        if (!RARRAY_LEN(splitted))
            ossl_raise(eSSLError, &quot;invalid input format&quot;);
        curve = RARRAY_AREF(splitted, 0);
        StringValueCStr(curve);

        /* SSL_CTX_set1_curves_list() accepts NIST names */
        nid = EC_curve_nist2nid(RSTRING_PTR(curve));
        if (nid == NID_undef)
            nid = OBJ_txt2nid(RSTRING_PTR(curve));
        if (nid == NID_undef)
            ossl_raise(eSSLError, &quot;unknown curve name&quot;);

        ec = EC_KEY_new_by_curve_name(nid);
        if (!ec)
            ossl_raise(eSSLError, NULL);
        EC_KEY_set_asn1_flag(ec, OPENSSL_EC_NAMED_CURVE);
        if (!SSL_CTX_set_tmp_ecdh(ctx, ec)) {
            EC_KEY_free(ec);
            ossl_raise(eSSLError, &quot;SSL_CTX_set_tmp_ecdh&quot;);
        }
        EC_KEY_free(ec);
# if defined(HAVE_SSL_CTX_SET_ECDH_AUTO)
        /* tmp_ecdh and ecdh_auto conflict. tmp_ecdh is ignored when ecdh_auto
         * is enabled. So disable ecdh_auto. */
        if (!SSL_CTX_set_ecdh_auto(ctx, 0))
            ossl_raise(eSSLError, &quot;SSL_CTX_set_ecdh_auto&quot;);
# endif
    }
#endif

    return arg;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-enable_fallback_scsv">
            
              <b>ctx.enable_fallback_scsv() => nil
</b>
            
            <a href="../../../classes/OpenSSL/SSL/SSLContext.html#method-i-enable_fallback_scsv" name="method-i-enable_fallback_scsv" class="permalink">Link</a>
          </div>

          
            <div class="description">
              <p>Activate TLS_FALLBACK_SCSV for this context. See RFC 7507.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-enable_fallback_scsv_source')" id="l_method-i-enable_fallback_scsv_source">show</a>
                
              </p>
              <div id="method-i-enable_fallback_scsv_source" class="dyn-source">
                <pre>static VALUE
ossl_sslctx_enable_fallback_scsv(VALUE self)
{
    SSL_CTX *ctx;

    GetSSLCTX(self, ctx);
    SSL_CTX_set_mode(ctx, SSL_MODE_SEND_FALLBACK_SCSV);

    return Qnil;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-flush_sessions">
            
              <b>ctx.flush_sessions(time) &rarr; self
</b>
            
            <a href="../../../classes/OpenSSL/SSL/SSLContext.html#method-i-flush_sessions" name="method-i-flush_sessions" class="permalink">Link</a>
          </div>

          
            <div class="description">
              <p>Removes sessions in the internal cache that have expired at <em>time</em>.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-flush_sessions_source')" id="l_method-i-flush_sessions_source">show</a>
                
              </p>
              <div id="method-i-flush_sessions_source" class="dyn-source">
                <pre>static VALUE
ossl_sslctx_flush_sessions(int argc, VALUE *argv, VALUE self)
{
    VALUE arg1;
    SSL_CTX *ctx;
    time_t tm = 0;

    rb_scan_args(argc, argv, &quot;01&quot;, &amp;arg1);

    GetSSLCTX(self, ctx);

    if (NIL_P(arg1)) {
        tm = time(0);
    } else if (rb_obj_is_instance_of(arg1, rb_cTime)) {
        tm = NUM2LONG(rb_funcall(arg1, rb_intern(&quot;to_i&quot;), 0));
    } else {
        ossl_raise(rb_eArgError, &quot;arg must be Time or nil&quot;);
    }

    SSL_CTX_flush_sessions(ctx, (long)tm);

    return self;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-freeze">
            
              <b>freeze</b>()
            
            <a href="../../../classes/OpenSSL/SSL/SSLContext.html#method-i-freeze" name="method-i-freeze" class="permalink">Link</a>
          </div>

          
            <div class="description">
              
            </div>
          

          

          
            <div class="aka">
              Alias for: <a href="SSLContext.html#method-i-setup">setup</a>
            </div>
          

          
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-max_version-3D">
            
              <b>ctx.max_version = OpenSSL::SSL::TLS1_2_VERSION<br />ctx.max_version = :TLS1_2<br />ctx.max_version = nil
</b>
            
            <a href="../../../classes/OpenSSL/SSL/SSLContext.html#method-i-max_version-3D" name="method-i-max_version-3D" class="permalink">Link</a>
          </div>

          
            <div class="description">
              <p>Sets the upper bound of the supported SSL/TLS protocol version. See <a
href="SSLContext.html#method-i-min_version-3D">min_version=</a> for the
possible values.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-max_version-3D_source')" id="l_method-i-max_version-3D_source">show</a>
                
              </p>
              <div id="method-i-max_version-3D_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ext/openssl/lib/openssl/ssl.rb, line 182</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">max_version=</span>(<span class="ruby-identifier">version</span>)
  <span class="ruby-identifier">set_minmax_proto_version</span>(<span class="ruby-ivar">@min_proto_version</span> <span class="ruby-operator">||=</span> <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">version</span>)
  <span class="ruby-ivar">@max_proto_version</span> = <span class="ruby-identifier">version</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-min_version-3D">
            
              <b>ctx.min_version = OpenSSL::SSL::TLS1_2_VERSION<br />ctx.min_version = :TLS1_2<br />ctx.min_version = nil
</b>
            
            <a href="../../../classes/OpenSSL/SSL/SSLContext.html#method-i-min_version-3D" name="method-i-min_version-3D" class="permalink">Link</a>
          </div>

          
            <div class="description">
              <p>Sets the lower bound on the supported SSL/TLS protocol version. The version
may be specified by an integer constant named OpenSSL::SSL::*_VERSION, a <a
href="../../Symbol.html">Symbol</a>, or <code>nil</code> which means “any
version”.</p>

<p>Be careful that you don&#39;t overwrite OpenSSL::SSL::OP_NO_{SSL,TLS}v*
options by <a href="SSLContext.html#method-i-options-3D">options=</a> once
you have called <a
href="SSLContext.html#method-i-min_version-3D">min_version=</a> or <a
href="SSLContext.html#method-i-max_version-3D">max_version=</a>.</p>

<h3 id="method-i-min_version-3D-label-Example">Example</h3>

<pre><code>ctx = OpenSSL::SSL::SSLContext.new
ctx.min_version = OpenSSL::SSL::TLS1_1_VERSION
ctx.max_version = OpenSSL::SSL::TLS1_2_VERSION

sock = OpenSSL::SSL::SSLSocket.new(tcp_sock, ctx)
sock.connect # Initiates a connection using either TLS 1.1 or TLS 1.2
</code></pre>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-min_version-3D_source')" id="l_method-i-min_version-3D_source">show</a>
                
              </p>
              <div id="method-i-min_version-3D_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ext/openssl/lib/openssl/ssl.rb, line 170</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">min_version=</span>(<span class="ruby-identifier">version</span>)
  <span class="ruby-identifier">set_minmax_proto_version</span>(<span class="ruby-identifier">version</span>, <span class="ruby-ivar">@max_proto_version</span> <span class="ruby-operator">||=</span> <span class="ruby-keyword">nil</span>)
  <span class="ruby-ivar">@min_proto_version</span> = <span class="ruby-identifier">version</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-options">
            
              <b>options</b>()
            
            <a href="../../../classes/OpenSSL/SSL/SSLContext.html#method-i-options" name="method-i-options" class="permalink">Link</a>
          </div>

          
            <div class="description">
              <p>Gets various <a href="../../OpenSSL.html">OpenSSL</a> options.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-options_source')" id="l_method-i-options_source">show</a>
                
              </p>
              <div id="method-i-options_source" class="dyn-source">
                <pre>static VALUE
ossl_sslctx_get_options(VALUE self)
{
    SSL_CTX *ctx;
    GetSSLCTX(self, ctx);
    /*
     * Do explicit cast because SSL_CTX_get_options() returned (signed) long in
     * OpenSSL before 1.1.0.
     */
    return ULONG2NUM((unsigned long)SSL_CTX_get_options(ctx));
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-options-3D">
            
              <b>options=</b>(p1)
            
            <a href="../../../classes/OpenSSL/SSL/SSLContext.html#method-i-options-3D" name="method-i-options-3D" class="permalink">Link</a>
          </div>

          
            <div class="description">
              <p>Sets various <a href="../../OpenSSL.html">OpenSSL</a> options.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-options-3D_source')" id="l_method-i-options-3D_source">show</a>
                
              </p>
              <div id="method-i-options-3D_source" class="dyn-source">
                <pre>static VALUE
ossl_sslctx_set_options(VALUE self, VALUE options)
{
    SSL_CTX *ctx;

    rb_check_frozen(self);
    GetSSLCTX(self, ctx);

    SSL_CTX_clear_options(ctx, SSL_CTX_get_options(ctx));

    if (NIL_P(options)) {
        SSL_CTX_set_options(ctx, SSL_OP_ALL);
    } else {
        SSL_CTX_set_options(ctx, NUM2ULONG(options));
    }

    return self;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-security_level">
            
              <b>ctx.security_level &rarr; Integer
</b>
            
            <a href="../../../classes/OpenSSL/SSL/SSLContext.html#method-i-security_level" name="method-i-security_level" class="permalink">Link</a>
          </div>

          
            <div class="description">
              <p>Returns the security level for the context.</p>

<p>See also <a
href="SSLContext.html#method-i-security_level-3D">#security_level=</a>.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-security_level_source')" id="l_method-i-security_level_source">show</a>
                
              </p>
              <div id="method-i-security_level_source" class="dyn-source">
                <pre>static VALUE
ossl_sslctx_get_security_level(VALUE self)
{
    SSL_CTX *ctx;

    GetSSLCTX(self, ctx);

#if defined(HAVE_SSL_CTX_GET_SECURITY_LEVEL)
    return INT2NUM(SSL_CTX_get_security_level(ctx));
#else
    (void)ctx;
    return INT2FIX(0);
#endif
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-security_level-3D">
            
              <b>ctx.security_level = integer
</b>
            
            <a href="../../../classes/OpenSSL/SSL/SSLContext.html#method-i-security_level-3D" name="method-i-security_level-3D" class="permalink">Link</a>
          </div>

          
            <div class="description">
              <p>Sets the security level for the context. <a
href="../../OpenSSL.html">OpenSSL</a> limits parameters according to the
level. The “parameters” include: ciphersuites, curves, key sizes,
certificate signature algorithms, protocol version and so on. For example,
level 1 rejects parameters offering below 80 bits of security, such as
ciphersuites using MD5 for the MAC or RSA keys shorter than 1024 bits.</p>

<p>Note that attempts to set such parameters with insufficient security are
also blocked. You need to lower the level first.</p>

<p>This feature is not supported in <a href="../../OpenSSL.html">OpenSSL</a>
&lt; 1.1.0, and setting the level to other than 0 will raise <a
href="../../NotImplementedError.html">NotImplementedError</a>. Level 0
means everything is permitted, the same behavior as previous versions of <a
href="../../OpenSSL.html">OpenSSL</a>.</p>

<p>See the manpage of SSL_CTX_set_security_level(3) for details.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-security_level-3D_source')" id="l_method-i-security_level-3D_source">show</a>
                
              </p>
              <div id="method-i-security_level-3D_source" class="dyn-source">
                <pre>static VALUE
ossl_sslctx_set_security_level(VALUE self, VALUE value)
{
    SSL_CTX *ctx;

    rb_check_frozen(self);
    GetSSLCTX(self, ctx);

#if defined(HAVE_SSL_CTX_GET_SECURITY_LEVEL)
    SSL_CTX_set_security_level(ctx, NUM2INT(value));
#else
    (void)ctx;
    if (NUM2INT(value) != 0)
        ossl_raise(rb_eNotImpError, &quot;setting security level to other than 0 is &quot;
                   &quot;not supported in this version of OpenSSL&quot;);
#endif

    return value;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-session_add">
            
              <b>ctx.session_add(session) &rarr; true | false
</b>
            
            <a href="../../../classes/OpenSSL/SSL/SSLContext.html#method-i-session_add" name="method-i-session_add" class="permalink">Link</a>
          </div>

          
            <div class="description">
              <p>Adds <em>session</em> to the session cache.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-session_add_source')" id="l_method-i-session_add_source">show</a>
                
              </p>
              <div id="method-i-session_add_source" class="dyn-source">
                <pre>static VALUE
ossl_sslctx_session_add(VALUE self, VALUE arg)
{
    SSL_CTX *ctx;
    SSL_SESSION *sess;

    GetSSLCTX(self, ctx);
    GetSSLSession(arg, sess);

    return SSL_CTX_add_session(ctx, sess) == 1 ? Qtrue : Qfalse;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-session_cache_mode">
            
              <b>ctx.session_cache_mode &rarr; Integer
</b>
            
            <a href="../../../classes/OpenSSL/SSL/SSLContext.html#method-i-session_cache_mode" name="method-i-session_cache_mode" class="permalink">Link</a>
          </div>

          
            <div class="description">
              <p>The current session cache mode.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-session_cache_mode_source')" id="l_method-i-session_cache_mode_source">show</a>
                
              </p>
              <div id="method-i-session_cache_mode_source" class="dyn-source">
                <pre>static VALUE
ossl_sslctx_get_session_cache_mode(VALUE self)
{
    SSL_CTX *ctx;

    GetSSLCTX(self, ctx);

    return LONG2NUM(SSL_CTX_get_session_cache_mode(ctx));
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-session_cache_mode-3D">
            
              <b>ctx.session_cache_mode=(integer) &rarr; Integer
</b>
            
            <a href="../../../classes/OpenSSL/SSL/SSLContext.html#method-i-session_cache_mode-3D" name="method-i-session_cache_mode-3D" class="permalink">Link</a>
          </div>

          
            <div class="description">
              <p>Sets the <a href="../SSL.html">SSL</a> session cache mode.  Bitwise-or
together the desired SESSION_CACHE_* constants to set.  See
SSL_CTX_set_session_cache_mode(3) for details.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-session_cache_mode-3D_source')" id="l_method-i-session_cache_mode-3D_source">show</a>
                
              </p>
              <div id="method-i-session_cache_mode-3D_source" class="dyn-source">
                <pre>static VALUE
ossl_sslctx_set_session_cache_mode(VALUE self, VALUE arg)
{
    SSL_CTX *ctx;

    GetSSLCTX(self, ctx);

    SSL_CTX_set_session_cache_mode(ctx, NUM2LONG(arg));

    return arg;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-session_cache_size">
            
              <b>ctx.session_cache_size &rarr; Integer
</b>
            
            <a href="../../../classes/OpenSSL/SSL/SSLContext.html#method-i-session_cache_size" name="method-i-session_cache_size" class="permalink">Link</a>
          </div>

          
            <div class="description">
              <p>Returns the current session cache size.  Zero is used to represent an
unlimited cache size.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-session_cache_size_source')" id="l_method-i-session_cache_size_source">show</a>
                
              </p>
              <div id="method-i-session_cache_size_source" class="dyn-source">
                <pre>static VALUE
ossl_sslctx_get_session_cache_size(VALUE self)
{
    SSL_CTX *ctx;

    GetSSLCTX(self, ctx);

    return LONG2NUM(SSL_CTX_sess_get_cache_size(ctx));
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-session_cache_size-3D">
            
              <b>ctx.session_cache_size=(integer) &rarr; Integer
</b>
            
            <a href="../../../classes/OpenSSL/SSL/SSLContext.html#method-i-session_cache_size-3D" name="method-i-session_cache_size-3D" class="permalink">Link</a>
          </div>

          
            <div class="description">
              <p>Sets the session cache size.  Returns the previously valid session cache
size.  Zero is used to represent an unlimited session cache size.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-session_cache_size-3D_source')" id="l_method-i-session_cache_size-3D_source">show</a>
                
              </p>
              <div id="method-i-session_cache_size-3D_source" class="dyn-source">
                <pre>static VALUE
ossl_sslctx_set_session_cache_size(VALUE self, VALUE arg)
{
    SSL_CTX *ctx;

    GetSSLCTX(self, ctx);

    SSL_CTX_sess_set_cache_size(ctx, NUM2LONG(arg));

    return arg;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-session_cache_stats">
            
              <b>ctx.session_cache_stats &rarr; Hash
</b>
            
            <a href="../../../classes/OpenSSL/SSL/SSLContext.html#method-i-session_cache_stats" name="method-i-session_cache_stats" class="permalink">Link</a>
          </div>

          
            <div class="description">
              <p>Returns a <a href="../../Hash.html">Hash</a> containing the following keys:</p>
<dl class="rdoc-list note-list"><dt>:accept
<dd>
<p>Number of started SSL/TLS handshakes in server mode</p>
</dd><dt>:accept_good
<dd>
<p>Number of established SSL/TLS sessions in server mode</p>
</dd><dt>:accept_renegotiate
<dd>
<p>Number of start renegotiations in server mode</p>
</dd><dt>:cache_full
<dd>
<p>Number of sessions that were removed due to cache overflow</p>
</dd><dt>:cache_hits
<dd>
<p>Number of successfully reused connections</p>
</dd><dt>:cache_misses
<dd>
<p>Number of sessions proposed by clients that were not found in the cache</p>
</dd><dt>:cache_num
<dd>
<p>Number of sessions in the internal session cache</p>
</dd><dt>:cb_hits
<dd>
<p>Number of sessions retrieved from the external cache in server mode</p>
</dd><dt>:connect
<dd>
<p>Number of started SSL/TLS handshakes in client mode</p>
</dd><dt>:connect_good
<dd>
<p>Number of established SSL/TLS sessions in client mode</p>
</dd><dt>:connect_renegotiate
<dd>
<p>Number of start renegotiations in client mode</p>
</dd><dt>:timeouts
<dd>
<p>Number of sessions proposed by clients that were found in the cache but had
expired due to timeouts</p>
</dd></dl>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-session_cache_stats_source')" id="l_method-i-session_cache_stats_source">show</a>
                
              </p>
              <div id="method-i-session_cache_stats_source" class="dyn-source">
                <pre>static VALUE
ossl_sslctx_get_session_cache_stats(VALUE self)
{
    SSL_CTX *ctx;
    VALUE hash;

    GetSSLCTX(self, ctx);

    hash = rb_hash_new();
    rb_hash_aset(hash, ID2SYM(rb_intern(&quot;cache_num&quot;)), LONG2NUM(SSL_CTX_sess_number(ctx)));
    rb_hash_aset(hash, ID2SYM(rb_intern(&quot;connect&quot;)), LONG2NUM(SSL_CTX_sess_connect(ctx)));
    rb_hash_aset(hash, ID2SYM(rb_intern(&quot;connect_good&quot;)), LONG2NUM(SSL_CTX_sess_connect_good(ctx)));
    rb_hash_aset(hash, ID2SYM(rb_intern(&quot;connect_renegotiate&quot;)), LONG2NUM(SSL_CTX_sess_connect_renegotiate(ctx)));
    rb_hash_aset(hash, ID2SYM(rb_intern(&quot;accept&quot;)), LONG2NUM(SSL_CTX_sess_accept(ctx)));
    rb_hash_aset(hash, ID2SYM(rb_intern(&quot;accept_good&quot;)), LONG2NUM(SSL_CTX_sess_accept_good(ctx)));
    rb_hash_aset(hash, ID2SYM(rb_intern(&quot;accept_renegotiate&quot;)), LONG2NUM(SSL_CTX_sess_accept_renegotiate(ctx)));
    rb_hash_aset(hash, ID2SYM(rb_intern(&quot;cache_hits&quot;)), LONG2NUM(SSL_CTX_sess_hits(ctx)));
    rb_hash_aset(hash, ID2SYM(rb_intern(&quot;cb_hits&quot;)), LONG2NUM(SSL_CTX_sess_cb_hits(ctx)));
    rb_hash_aset(hash, ID2SYM(rb_intern(&quot;cache_misses&quot;)), LONG2NUM(SSL_CTX_sess_misses(ctx)));
    rb_hash_aset(hash, ID2SYM(rb_intern(&quot;cache_full&quot;)), LONG2NUM(SSL_CTX_sess_cache_full(ctx)));
    rb_hash_aset(hash, ID2SYM(rb_intern(&quot;timeouts&quot;)), LONG2NUM(SSL_CTX_sess_timeouts(ctx)));

    return hash;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-session_remove">
            
              <b>ctx.session_remove(session) &rarr; true | false
</b>
            
            <a href="../../../classes/OpenSSL/SSL/SSLContext.html#method-i-session_remove" name="method-i-session_remove" class="permalink">Link</a>
          </div>

          
            <div class="description">
              <p>Removes <em>session</em> from the session cache.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-session_remove_source')" id="l_method-i-session_remove_source">show</a>
                
              </p>
              <div id="method-i-session_remove_source" class="dyn-source">
                <pre>static VALUE
ossl_sslctx_session_remove(VALUE self, VALUE arg)
{
    SSL_CTX *ctx;
    SSL_SESSION *sess;

    GetSSLCTX(self, ctx);
    GetSSLSession(arg, sess);

    return SSL_CTX_remove_session(ctx, sess) == 1 ? Qtrue : Qfalse;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-set_params">
            
              <b>ctx.set_params(params = {}) &rarr; params
</b>
            
            <a href="../../../classes/OpenSSL/SSL/SSLContext.html#method-i-set_params" name="method-i-set_params" class="permalink">Link</a>
          </div>

          
            <div class="description">
              <p>Sets saner defaults optimized for the use with HTTP-like protocols.</p>

<p>If a <a href="../../Hash.html">Hash</a> <em>params</em> is given, the
parameters are overridden with it. The keys in <em>params</em> must be
assignment methods on <a href="SSLContext.html">SSLContext</a>.</p>

<p>If the <a href="SSLContext.html#attribute-i-verify_mode">#verify_mode</a>
is not VERIFY_NONE and <a
href="SSLContext.html#attribute-i-ca_file">#ca_file</a>, <a
href="SSLContext.html#attribute-i-ca_path">#ca_path</a> and <a
href="SSLContext.html#attribute-i-cert_store">#cert_store</a> are not set
then the system default certificate store is used.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-set_params_source')" id="l_method-i-set_params_source">show</a>
                
              </p>
              <div id="method-i-set_params_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ext/openssl/lib/openssl/ssl.rb, line 138</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">set_params</span>(<span class="ruby-identifier">params</span>={})
  <span class="ruby-identifier">params</span> = <span class="ruby-constant">DEFAULT_PARAMS</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">params</span>)
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">options</span> = <span class="ruby-identifier">params</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value">:options</span>) <span class="ruby-comment"># set before min_version/max_version</span>
  <span class="ruby-identifier">params</span>.<span class="ruby-identifier">each</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">name</span>, <span class="ruby-identifier">value</span><span class="ruby-operator">|</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">__send__</span>(<span class="ruby-node">&quot;#{name}=&quot;</span>, <span class="ruby-identifier">value</span>) }
  <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">verify_mode</span> <span class="ruby-operator">!=</span> <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">SSL</span><span class="ruby-operator">::</span><span class="ruby-constant">VERIFY_NONE</span>
    <span class="ruby-keyword">unless</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">ca_file</span> <span class="ruby-keyword">or</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">ca_path</span> <span class="ruby-keyword">or</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">cert_store</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">cert_store</span> = <span class="ruby-constant">DEFAULT_CERT_STORE</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">params</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-setup">
            
              <b>ctx.setup => Qtrue # first time<br />ctx.setup => nil # thereafter
</b>
            
            <a href="../../../classes/OpenSSL/SSL/SSLContext.html#method-i-setup" name="method-i-setup" class="permalink">Link</a>
          </div>

          
            <div class="description">
              <p>This method is called automatically when a new <a
href="SSLSocket.html">SSLSocket</a> is created. However, it is not
thread-safe and must be called before creating <a
href="SSLSocket.html">SSLSocket</a> objects in a multi-threaded program.</p>
            </div>
          

          
            <div class="aka">
              Also aliased as: <a href="SSLContext.html#method-i-freeze">freeze</a>
            </div>
          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-setup_source')" id="l_method-i-setup_source">show</a>
                
              </p>
              <div id="method-i-setup_source" class="dyn-source">
                <pre>static VALUE
ossl_sslctx_setup(VALUE self)
{
    SSL_CTX *ctx;
    X509 *cert = NULL, *client_ca = NULL;
    EVP_PKEY *key = NULL;
    char *ca_path = NULL, *ca_file = NULL;
    int verify_mode;
    long i;
    VALUE val;

    if(OBJ_FROZEN(self)) return Qnil;
    GetSSLCTX(self, ctx);

#if !defined(OPENSSL_NO_DH)
    SSL_CTX_set_tmp_dh_callback(ctx, ossl_tmp_dh_callback);
#endif

#if !defined(OPENSSL_NO_EC)
    /* We added SSLContext#tmp_ecdh_callback= in Ruby 2.3.0,
     * but SSL_CTX_set_tmp_ecdh_callback() was removed in OpenSSL 1.1.0. */
    if (RTEST(rb_attr_get(self, id_i_tmp_ecdh_callback))) {
# if defined(HAVE_SSL_CTX_SET_TMP_ECDH_CALLBACK)
        rb_warn(&quot;#tmp_ecdh_callback= is deprecated; use #ecdh_curves= instead&quot;);
        SSL_CTX_set_tmp_ecdh_callback(ctx, ossl_tmp_ecdh_callback);
#  if defined(HAVE_SSL_CTX_SET_ECDH_AUTO)
        /* tmp_ecdh_callback and ecdh_auto conflict; OpenSSL ignores
         * tmp_ecdh_callback. So disable ecdh_auto. */
        if (!SSL_CTX_set_ecdh_auto(ctx, 0))
            ossl_raise(eSSLError, &quot;SSL_CTX_set_ecdh_auto&quot;);
#  endif
# else
        ossl_raise(eSSLError, &quot;OpenSSL does not support tmp_ecdh_callback; &quot;
                   &quot;use #ecdh_curves= instead&quot;);
# endif
    }
#endif /* OPENSSL_NO_EC */

    val = rb_attr_get(self, id_i_cert_store);
    if (!NIL_P(val)) {
        X509_STORE *store = GetX509StorePtr(val); /* NO NEED TO DUP */
        SSL_CTX_set_cert_store(ctx, store);
#if !defined(HAVE_X509_STORE_UP_REF)
        /*
         * WORKAROUND:
         *   X509_STORE can count references, but
         *   X509_STORE_free() doesn&#39;t care it.
         *   So we won&#39;t increment it but mark it by ex_data.
         */
        SSL_CTX_set_ex_data(ctx, ossl_sslctx_ex_store_p, ctx);
#else /* Fixed in OpenSSL 1.0.2; bff9ce4db38b (master), 5b4b9ce976fc (1.0.2) */
        X509_STORE_up_ref(store);
#endif
    }

    val = rb_attr_get(self, id_i_extra_chain_cert);
    if(!NIL_P(val)){
        rb_block_call(val, rb_intern(&quot;each&quot;), 0, 0, ossl_sslctx_add_extra_chain_cert_i, self);
    }

    /* private key may be bundled in certificate file. */
    val = rb_attr_get(self, id_i_cert);
    cert = NIL_P(val) ? NULL : GetX509CertPtr(val); /* NO DUP NEEDED */
    val = rb_attr_get(self, id_i_key);
    key = NIL_P(val) ? NULL : GetPrivPKeyPtr(val); /* NO DUP NEEDED */
    if (cert &amp;&amp; key) {
        if (!SSL_CTX_use_certificate(ctx, cert)) {
            /* Adds a ref =&gt; Safe to FREE */
            ossl_raise(eSSLError, &quot;SSL_CTX_use_certificate&quot;);
        }
        if (!SSL_CTX_use_PrivateKey(ctx, key)) {
            /* Adds a ref =&gt; Safe to FREE */
            ossl_raise(eSSLError, &quot;SSL_CTX_use_PrivateKey&quot;);
        }
        if (!SSL_CTX_check_private_key(ctx)) {
            ossl_raise(eSSLError, &quot;SSL_CTX_check_private_key&quot;);
        }
    }

    val = rb_attr_get(self, id_i_client_ca);
    if(!NIL_P(val)){
        if (RB_TYPE_P(val, T_ARRAY)) {
            for(i = 0; i &lt; RARRAY_LEN(val); i++){
                client_ca = GetX509CertPtr(RARRAY_AREF(val, i));
                if (!SSL_CTX_add_client_CA(ctx, client_ca)){
                    /* Copies X509_NAME =&gt; FREE it. */
                    ossl_raise(eSSLError, &quot;SSL_CTX_add_client_CA&quot;);
                }
            }
        }
        else{
            client_ca = GetX509CertPtr(val); /* NO DUP NEEDED. */
            if (!SSL_CTX_add_client_CA(ctx, client_ca)){
                /* Copies X509_NAME =&gt; FREE it. */
                ossl_raise(eSSLError, &quot;SSL_CTX_add_client_CA&quot;);
            }
        }
    }

    val = rb_attr_get(self, id_i_ca_file);
    ca_file = NIL_P(val) ? NULL : StringValueCStr(val);
    val = rb_attr_get(self, id_i_ca_path);
    ca_path = NIL_P(val) ? NULL : StringValueCStr(val);
    if(ca_file || ca_path){
        if (!SSL_CTX_load_verify_locations(ctx, ca_file, ca_path))
            rb_warning(&quot;can&#39;t set verify locations&quot;);
    }

    val = rb_attr_get(self, id_i_verify_mode);
    verify_mode = NIL_P(val) ? SSL_VERIFY_NONE : NUM2INT(val);
    SSL_CTX_set_verify(ctx, verify_mode, ossl_ssl_verify_callback);
    if (RTEST(rb_attr_get(self, id_i_client_cert_cb)))
        SSL_CTX_set_client_cert_cb(ctx, ossl_client_cert_cb);

    val = rb_attr_get(self, id_i_timeout);
    if(!NIL_P(val)) SSL_CTX_set_timeout(ctx, NUM2LONG(val));

    val = rb_attr_get(self, id_i_verify_depth);
    if(!NIL_P(val)) SSL_CTX_set_verify_depth(ctx, NUM2INT(val));

#ifndef OPENSSL_NO_NEXTPROTONEG
    val = rb_attr_get(self, id_i_npn_protocols);
    if (!NIL_P(val)) {
        VALUE encoded = ssl_encode_npn_protocols(val);
        rb_ivar_set(self, id_npn_protocols_encoded, encoded);
        SSL_CTX_set_next_protos_advertised_cb(ctx, ssl_npn_advertise_cb, (void *)encoded);
        OSSL_Debug(&quot;SSL NPN advertise callback added&quot;);
    }
    if (RTEST(rb_attr_get(self, id_i_npn_select_cb))) {
        SSL_CTX_set_next_proto_select_cb(ctx, ssl_npn_select_cb, (void *) self);
        OSSL_Debug(&quot;SSL NPN select callback added&quot;);
    }
#endif

#ifdef HAVE_SSL_CTX_SET_ALPN_SELECT_CB
    val = rb_attr_get(self, id_i_alpn_protocols);
    if (!NIL_P(val)) {
        VALUE rprotos = ssl_encode_npn_protocols(val);

        /* returns 0 on success */
        if (SSL_CTX_set_alpn_protos(ctx, (unsigned char *)RSTRING_PTR(rprotos),
                                    RSTRING_LENINT(rprotos)))
            ossl_raise(eSSLError, &quot;SSL_CTX_set_alpn_protos&quot;);
        OSSL_Debug(&quot;SSL ALPN values added&quot;);
    }
    if (RTEST(rb_attr_get(self, id_i_alpn_select_cb))) {
        SSL_CTX_set_alpn_select_cb(ctx, ssl_alpn_select_cb, (void *) self);
        OSSL_Debug(&quot;SSL ALPN select callback added&quot;);
    }
#endif

    rb_obj_freeze(self);

    val = rb_attr_get(self, id_i_session_id_context);
    if (!NIL_P(val)){
        StringValue(val);
        if (!SSL_CTX_set_session_id_context(ctx, (unsigned char *)RSTRING_PTR(val),
                                            RSTRING_LENINT(val))){
            ossl_raise(eSSLError, &quot;SSL_CTX_set_session_id_context&quot;);
        }
    }

    if (RTEST(rb_attr_get(self, id_i_session_get_cb))) {
        SSL_CTX_sess_set_get_cb(ctx, ossl_sslctx_session_get_cb);
        OSSL_Debug(&quot;SSL SESSION get callback added&quot;);
    }
    if (RTEST(rb_attr_get(self, id_i_session_new_cb))) {
        SSL_CTX_sess_set_new_cb(ctx, ossl_sslctx_session_new_cb);
        OSSL_Debug(&quot;SSL SESSION new callback added&quot;);
    }
    if (RTEST(rb_attr_get(self, id_i_session_remove_cb))) {
        SSL_CTX_sess_set_remove_cb(ctx, ossl_sslctx_session_remove_cb);
        OSSL_Debug(&quot;SSL SESSION remove callback added&quot;);
    }

    val = rb_attr_get(self, id_i_servername_cb);
    if (!NIL_P(val)) {
        SSL_CTX_set_tlsext_servername_callback(ctx, ssl_servername_cb);
        OSSL_Debug(&quot;SSL TLSEXT servername callback added&quot;);
    }

    return Qtrue;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-ssl_version-3D">
            
              <b>ctx.ssl_version = :TLSv1<br />ctx.ssl_version = "SSLv23"
</b>
            
            <a href="../../../classes/OpenSSL/SSL/SSLContext.html#method-i-ssl_version-3D" name="method-i-ssl_version-3D" class="permalink">Link</a>
          </div>

          
            <div class="description">
              <p>Sets the SSL/TLS protocol version for the context. This forces connections
to use only the specified protocol version. This is deprecated and only
provided for backwards compatibility. Use <a
href="SSLContext.html#method-i-min_version-3D">min_version=</a> and <a
href="SSLContext.html#method-i-max_version-3D">max_version=</a> instead.</p>

<h3 id="method-i-ssl_version-3D-label-History">History</h3>

<p>As the name hints, this used to call the SSL_CTX_set_ssl_version() function
which sets the <a href="../SSL.html">SSL</a> method used for connections
created from the context. As of Ruby/OpenSSL 2.1, this accessor method is
implemented to call <a
href="SSLContext.html#method-i-min_version-3D">min_version=</a> and <a
href="SSLContext.html#method-i-max_version-3D">max_version=</a> instead.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-ssl_version-3D_source')" id="l_method-i-ssl_version-3D_source">show</a>
                
              </p>
              <div id="method-i-ssl_version-3D_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ext/openssl/lib/openssl/ssl.rb, line 201</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">ssl_version=</span>(<span class="ruby-identifier">meth</span>)
  <span class="ruby-identifier">meth</span> = <span class="ruby-identifier">meth</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">meth</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Symbol</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-regexp">/(?&lt;type&gt;_client|_server)\z/</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">meth</span>
    <span class="ruby-identifier">meth</span> = <span class="ruby-node">$`</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">$VERBOSE</span>
      <span class="ruby-identifier">warn</span> <span class="ruby-node">&quot;#{caller(1, 1)[0]}: method type #{type.inspect} is ignored&quot;</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">version</span> = <span class="ruby-constant">METHODS_MAP</span>[<span class="ruby-identifier">meth</span>.<span class="ruby-identifier">intern</span>] <span class="ruby-keyword">or</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>, <span class="ruby-string">&quot;unknown SSL method `%s&#39;&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">meth</span>
  <span class="ruby-identifier">set_minmax_proto_version</span>(<span class="ruby-identifier">version</span>, <span class="ruby-identifier">version</span>)
  <span class="ruby-ivar">@min_proto_version</span> = <span class="ruby-ivar">@max_proto_version</span> = <span class="ruby-identifier">version</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
                    </div>

    </div>
  </body>
</html>
